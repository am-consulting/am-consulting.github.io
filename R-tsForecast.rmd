```{r}
library(quantmod);library(lubridate);library(forecast);library(dplyr);library(ggplot2);library(scales)
periodN <- 30
fromFRED <- 
  c('Japan / U.S. Foreign Exchange Rate (DEXJPUS)',
    'U.S. / Euro Foreign Exchange Rate (DEXUSEU)',
    'Canada / U.S. Foreign Exchange Rate (DEXCAUS)',
    'U.S. / U.K. Foreign Exchange Rate (DEXUSUK)',
    'U.S. / Australia Foreign Exchange Rate (DEXUSAL)',
    'Switzerland / U.S. Foreign Exchange Rate (DEXSZUS)',
    'South Africa / U.S. Foreign Exchange Rate (DEXSFUS)',
    'U.S. / New Zealand Foreign Exchange Rate (DEXUSNZ)',
    'S&P 500© (SP500)',
    'NASDAQ Composite Index© (NASDAQCOM)',
    'Dow Jones Industrial Average© (DJIA)',
    'Nikkei Stock Average, Nikkei 225© (NIKKEI225)')
FUN <- 'mean'
for(iii in seq(length(fromFRED))){
  buf <- fromFRED[iii]
  title <- gsub('(.+)\\((.+)\\)','\\1',buf)
  symbol <- gsub('(.+)\\((.+)\\)','\\2',buf)
  tmp0 <- na.omit(getSymbols(Symbols = symbol,auto.assign = F,src = 'FRED'))
  tmp1 <-
    data.frame(Date = index(tmp0),
               tmp0,
               YM = as.Date(paste0(year(index(tmp0)),'-',month(index(tmp0)),'-1')), 
               stringsAsFactors = F,check.names = F,row.names = NULL)
  tmp2 <- aggregate(x = tmp1[,2],by = list(tmp1$YM),FUN = FUN)
  colnames(tmp2)[2] <- paste0(title,':',FUN)
  tsData <- 
    ts(data = tmp2[,2],start = c(year(head(tmp2$Group.1,1)),month(head(tmp2$Group.1,1))),frequency = 12)
  arimaResult <- auto.arima(tsData)
  forecastResult <- forecast(arimaResult,level = c(95),h = 6)
  forecasted <- as.data.frame(forecastResult)
  forecasted$Date <- as.Date(time(forecastResult$mean))
  fitted <- 
    data.frame(Date = as.Date(time(forecastResult$fitted)),
               Original = forecastResult$x,
               Fitted = forecastResult$fitted)
  plotData <- bind_rows(fitted,forecasted)
  plotData <- tail(plotData,12*3)
  g <- ggplot(data = plotData)
  g <- g + geom_line(mapping = aes_string(x = 'Date',y = 'Original'))
  g <- g + geom_point(mapping = aes_string(x = 'Date',y = 'Original'))
  g <- g + geom_line(mapping = aes_string(x = 'Date',y = 'Fitted'),colour='red')
  g <- g + geom_line(mapping = aes_string(x = 'Date',y = '`Point Forecast`'),colour='blue',size=1)
  g <- g + geom_point(mapping = aes_string(x = 'Date',y = '`Point Forecast`'),colour='blue',size=1)
  g <- g + geom_ribbon(mapping = aes_string(x = 'Date',ymin = '`Lo 95`',ymax = '`Hi 95`'),alpha = 0.2)
  g <- g + geom_point(mapping = aes_string(x = 'Date',y = '`Lo 95`'),colour='blue',size=1)
  g <- g + geom_point(mapping = aes_string(x = 'Date',y = '`Hi 95`'),colour='blue',size=1)
  g <- g + scale_x_date(name = '',date_breaks = "1 month",labels= date_format("%Y-%m"))
  g <- g + scale_y_continuous(name = '',breaks = scales::pretty_breaks(10),sec.axis = dup_axis())
  g <- g + ggtitle(label = title)
  g <- g + theme(plot.title = element_text(hjust = 0.5,family = "Meiryo",size = 20))
  g <- g + theme(axis.title.x = element_text(family = "Meiryo",size = 16)) 
  g <- g + theme(axis.title.y = element_text(family = "Meiryo",size = 16)) 
  g <- g + theme(axis.text.x = element_text(angle = 90,family = "Meiryo",size = 12,vjust = 0.5)) 
  g <- g + theme(axis.text.y = element_text(angle = 0,family = "Meiryo",size = 16))
  print(g)
}
```
