---
knit: (function(inputFile, encoding) {username<-Sys.info()['user'];fileName<-'defaultPath.csv';pathToFile <-paste0('C:/Users/', username,'/Desktop/pathToCSV/');setwd(pathToFile);buf0<-read.csv(fileName,header = F,skip = 0,stringsAsFactor = F,check.names = F,fileEncoding = 'utf-8');timeStamp<-format(Sys.time(),'%Y%m%d%H%M%S');htmlName<-'okunsLaw';rmarkdown::render(inputFile, encoding = encoding, output_file = paste0('C:/Users/',username,buf0[2,1],'charts/','am-consulting.co.jp-',htmlName,'.html')) })

title : 'GDP(Expenditure Approach) × Unemployment Rate'
author: "アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp"
date: "`r format(Sys.time(), '%Y-%m-%d %H:%M:%S')`"
output: 
  html_document:
    fig_height: 5
    fig_width: 10
    keep_md: no
    md_extensions: -ascii_identifiers 
    includes:
       in_header: insertHeader.html
    self_contained: false
---

```{r setup, include=FALSE}
tag <-
  read.csv(file = 'https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/components/insertHeader.csv',header = F,fileEncoding = 'UTF8')
tagTxt <- ''
for(rrr in 1:nrow(tag)){
  tagTxt <- paste0(tagTxt,tag[rrr,1],'\n')
}
insertFile <- file("insertHeader.html")
writeLines(text = tagTxt,con = insertFile)
close(insertFile)
```

<style>.main-container {max-width : 1000px;}</style>

- アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp
- SaECaNet http://saecanet.com/
- Olive http://olive.saecanet.com/
- twitter https://twitter.com/AMC2_Japan
- 本ページへのリンクを共有:<a href="https://twitter.com/share" class="twitter-share-button" data-via="AMC2_Japan" data-size="large">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

```{r set-options, echo=F, cache=F}
options(width = 1000)
```

```{r,warning=F,error=F,message=F,echo=F}
windowsFonts(Meiryo = windowsFont("Meiryo"))
options(scipen=100)
library(lubridate)
```

```{r warning = F, error = F, message = F, echo = F}
library(RCurl)
fileName <- 'functionList.csv'
functionList <-
  read.csv(
    file = paste0('https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/csv/',
                  fileName),
    header = F,
    as.is = T)
for(iii in 1:nrow(functionList)){
  script <- 
    getURL(paste0("https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/", 
                  functionList[iii,1]),
           ssl.verifypeer = F)
  eval(parse(text = script))
}
```

```{r warning = F, error = F, message = F, echo = F}
# http://www.esri.cao.go.jp/jp/sna/data/data_list/sokuhou/files/2016/qe163_2/gdemenuja.html
importAMCC <- 
  c('importGDPofJapan.r')
for(iii in 1:length(importAMCC)){
  script <-
    getURL(
      paste0("https://raw.githubusercontent.com/am-consulting/Rscript/master/",
             importAMCC[iii]),
      ssl.verifypeer = F)
  eval(parse(text = script))
}
```

```{r warning = F, error = F, message = F, echo = F, results='hide'}
# csv出力パート
scriptFile <- 'R-writeCSVtoFolder.r'
script <-
  RCurl::getURL(
    paste0("https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/",
           scriptFile),
    ssl.verifypeer = F)
eval(parse(text = script))
# csv出力パート
# 完全失業率 年平均結果、全国、前年比パート
library(XLConnect)
username <- 
  Sys.info()['user']
pathOutput <- 
  paste0("C:/Users/", username, "/Desktop/R_Data_Write/")
setwd(pathOutput)
fileName <- 
  'lt02.xls'
dataURL <- 
  'http://www.stat.go.jp/data/roudou/longtime/zuhyou/'
download.file(paste0(dataURL,fileName), fileName , mode = 'wb')
buf0 <-
  readWorksheetFromFile(paste0(pathOutput, fileName), sheet = 1, check.names = F, header = F)
dateColumn <-
  paste0(as.numeric(gsub('\\(|\\)|\\s|・','',buf0[,2])),'-1-1')
titleColumn <-
  grep('完全失業率',buf0[6,])[1]
sheetTitle <- 
  gsub('\\s','',zen2han(buf0[6,titleColumn]))
valueColumn <-
  gsub('<|>','',buf0[,titleColumn])
buf1 <-
  data.frame(dateColumn,valueColumn,stringsAsFactors = F)
buf1[,2] <- 
  as.numeric(buf1[,2])
buf2 <- 
  na.omit(buf1)
buf2[,1] <- 
  as.Date(buf2[,1])
colnames(buf2) <- 
  c('Date', sheetTitle)
unemploymentRateYearly <- buf2
unemploymentRateYearlyYoY <- fun_makeDiffTable(unemploymentRateYearly)
colnames(unemploymentRateYearlyYoY)[2] <- 
  paste0(colnames(unemploymentRateYearlyYoY)[2],':前年比(%ポイント)')
# csv出力パート
fun_writeCSVtoFolder(objData = unemploymentRateYearly,dataType = 1,csvFileName = 'unemploymentRateYearly')
fun_writeCSVtoFolder(objData = unemploymentRateYearlyYoY,dataType = 1,csvFileName = 'unemploymentRateYearlyYoY')
# csv出力パート
```

```{r warning = F, error = F, message = F, echo = F, results='hide'}
# 実質GDP前期比パート
obj0 <- 
  get(paste0('gdp', grep('実質暦年\\(前年比\\)',sheetTitlesJ)))[,c(1,2)]
tail(obj0)
assign('realGDPYearlyYoY',
       obj0,
       envir = .GlobalEnv)
```

```{r,warning=F,error=F,message=F,results='hold',echo=F}
dateFormat <- '%Y年%m月'
dataTitle <- 
  paste0('国内総生産の前年比(%)と完全失業率の前年比(パーセントポイント):オークンの法則')
dataSource <- 
  '総務省、内閣府'
```

***

- `r paste0("タイトル : ", dataTitle)`
- `r paste0("データ出所 : ", dataSource)`
- https://en.wikipedia.org/wiki/Okun%27s_law
- http://www.esri.cao.go.jp/jp/sna/data/data_list/sokuhou/files/2016/qe163_2/gdemenuja.html
- http://www.stat.go.jp/data/roudou/longtime/03roudou.htm#hyo_1
- 注意:各時系列データが非定常を棄却できているか否か、単位根検定欄を確認し留意して下さい。
- 以下は総務省Webサイトからの引用(失業率について)

<blockquote>

2011年3月から8月までの期間は東日本大震災の影響により全国集計結果が存在しないため補完推計値(新基準)を用いた。<br><br>【参考】http://www.stat.go.jp/data/roudou/120424/index.htm

</blockquote>

***

$$ 
\begin{align}
\frac{\Delta Y}{Y} & = k-c \times \Delta u \\  \\
Y &  \textrm{ is actual output.} \\
c &  \textrm{ is the factor relating changes in unemployment to changes in output.}\\
\Delta Y & \textrm{ is the change in actual output from one year to the next.}\\
\Delta u & \textrm{ is the change in actual unemployment from one year to the next.}\\
k & \textrm{ is the average annual growth rate of full-employment output.}
\end{align}
$$ 


- Source https://en.wikipedia.org/wiki/Okun%27s_law

***

```{r warning = F, error = F, message = F, echo = F, results='hide'}
mergeData <-
  merge(unemploymentRateYearlyYoY, realGDPYearlyYoY, by = 'Date')
mergeDataExcluding2011 <- 
  subset(mergeData, year(mergeData[,1])!=2011)
tail(mergeData)
```

```{r warning = F, error = F, message = F, echo = F}
fun_plotScatter <- function(objDF){
objX <- 
  grep('国内総生産',colnames(objDF))
realGDPYearlyYoY <<- 
  objDF[,objX]
objY <- 
  grep('失業率',colnames(objDF))
unemploymentRateYearlyYoY <<- 
  objDF[,objY]
par(mar=c(5,5,1,1), family = 'Meiryo', 
    cex.main = 1.1, cex.lab = 1.0, cex.axis = 1.0, font.main = 1, font.lab = 1, font.axis =1)
plot(objDF[,objX],
     objDF[,objY],
     xlab = colnames(objDF)[objX],
     ylab = colnames(objDF)[objY],
     panel.first = grid(nx = NULL,
                        ny = NULL,
                        lty = 2,
                        equilogs = T),
     type = 'p',
     pch = 20,
     col = 'blue',
     asp = 1,
     cex = 1.5)
text(objDF[,objX],
     objDF[,objY],
     labels = format(objDF[,1],'%Y年'),
     adj = 1,
     cex = 0.8,
     font = 1)
abline(h = 0, col = 'red')
abline(v = 0, col = 'red')
lmResult <<-
  lm(unemploymentRateYearlyYoY ~ realGDPYearlyYoY)
abline(lmResult,
       col = 'blue',
       lwd = 2)
}
```

```{r warning = F, error = F, message = F, echo = F, results='asis'}
DTtable <- mergeData
DTtable[,1] <- format(DTtable[,1], '%Y年')
fun_markdownTable(DTtable)
```

***

#### 2011年を含める場合
- 散布図 & 線形回帰直線
```{r warning = F, error = F, message = F, echo = F, results='asis', fig.height=5 }
fun_plotScatter(objDF = mergeData)
```

- 線形回帰

```{r warning = F, error = F, message = F, echo = F, results='hold'}
cat('線形回帰の結果\n\n')
summary(lmResult)
cat('\n\n')
cat('Slopeの95%信頼区間\n\n')
confint(lmResult, 'realGDPYearlyYoY', level=0.95)
cat('\n\n')
cat('相関係数(r = Multiple R-squared ^ 0.5)\n\n')
(summary(lmResult)$r.squared)^0.5
```

- 単位根検定

```{r warning = F, error = F, message = F, echo = F, results='hold'}
adf.test(unemploymentRateYearlyYoY)
cat('\n\n')
adf.test(realGDPYearlyYoY)
```

#### 2011年を含めない場合
- 散布図 & 線形回帰直線
```{r warning = F, error = F, message = F, echo = F, results='asis', fig.height=5 }
fun_plotScatter(objDF = mergeDataExcluding2011)
```

-  線形回帰

```{r warning = F, error = F, message = F, echo = F, results='hold'}
cat('線形回帰の結果\n\n')
summary(lmResult)
cat('\n\n')
cat('Slopeの95%信頼区間\n\n')
confint(lmResult, 'realGDPYearlyYoY', level=0.95)
cat('\n\n')
cat('相関係数(r = Multiple R-squared ^ 0.5)\n\n')
(summary(lmResult)$r.squared)^0.5
```

- 単位根検定

```{r warning = F, error = F, message = F, echo = F, results='hold'}
adf.test(unemploymentRateYearlyYoY)
cat('\n\n')
adf.test(realGDPYearlyYoY)
```

```{r warning=F,error=F,message=F,echo=F,results='hide'}
fun_preparePlot()
pngFile <-
  paste0(htmlName, "1.png")
png(file = pngFile, width = 1000, height = 600)
##################
fun_plotTimeSeries(obj = mergeData,typeL = 'o',typeR = 'o',dateFormat = dateFormat,chartType = 2,dataSource = dataSource,mar = c(4,5,5,5),cexL = 1.5,cexR = 1.5)
dev.off()
```

```{r warning=F,error=F,message=F,echo=F,results='hide'}
fun_outputMD(tags = '完全失業率,国内総生産',
             objDF = mergeData,
             htmlName = htmlName,
             image1 = 1,
             title = dataTitle,
             tableTitle = paste0(colnames(mergeData)[-1],collapse = '×'),
             tableName = paste0(colnames(mergeData)[-1],collapse = '×'))
fun_updateURLcsv()
```

***
<script>MakeNegative();</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-3077339-5', 'auto');
  ga('send', 'pageview');

</script>
