---
knit: (function(inputFile, encoding) {username<-Sys.info()['user'];fileName<-'defaultPath.csv';pathToFile <-paste0('C:/Users/', username,'/Desktop/pathToCSV/');setwd(pathToFile);buf0<-read.csv(fileName,header = F,skip = 0,stringsAsFactor = F,check.names = F,fileEncoding = 'utf-8');timeStamp<-format(Sys.time(),'%Y%m%d%H%M%S');htmlName<-'CountriesOfTheWorld';rmarkdown::render(inputFile, encoding = encoding, output_file = paste0('C:/Users/',username,buf0[2,1],'charts/','am-consulting.co.jp-',htmlName,'.html')) })

title : 'Countries Of The World'
author: "アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp"
date: "`r format(Sys.time(), '%Y-%m-%d %H:%M:%S')`"
output: 
  html_document:
    fig_height: 5
    fig_width: 10
    keep_md: no
    md_extensions: -ascii_identifiers
---
<link href="http://knowledgevault.saecanet.com/components/rmarkdown-html.css" rel="stylesheet">
<script src="http://knowledgevault.saecanet.com/components/JavascriptCode.js"></script>
<style>.main-container {max-width : 1000px;}</style>

- アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp
- SaECaNet http://saecanet.com/
- Olive http://olive.saecanet.com/
- twitter https://twitter.com/AMC2_Japan
- 本ページへのリンクを共有:<a href="https://twitter.com/share" class="twitter-share-button" data-via="AMC2_Japan" data-size="large">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

```{r warning = F,error = F,message = F,echo = F,results = 'hide'}
fileName <- 
  'functionList.csv'
baseURL <- 
  'https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/'
functionList <- 
  read.csv(
    file = paste0(baseURL,'csv/',fileName),
    header = F,
    as.is = T)
for(iii in 1:nrow(functionList)){
  script <- 
    RCurl::getURL(paste0(baseURL,functionList[iii,1]),ssl.verifypeer = F)
  eval(parse(text = script))
}
```

### Google Map

<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d7187362.308715542!2d20.18143093148129!3d-28.405547131550506!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x1c34a689d9ee1251%3A0xe85d630c1fa4e8a0!2z5Y2X44Ki44OV44Oq44Kr!5e0!3m2!1sja!2sjp!4v1497322786457" width="1000" height="400" frameborder="0" style="border:0" allowfullscreen></iframe>

***

### Economic Data From FRED

```{r warning = F,error = F,message = F,echo = F,results = 'asis'}
windowsFonts(Meiryo = windowsFont("Meiryo"))
library(quantmod)
library(lubridate)
#### FRED part
SouthAfrica <- 
  c(
    'DEXSFUS',
    'South Africa / U.S. Foreign Exchange Rate',
    'South African Rand to One U.S. Dollar,Not Seasonally Adjusted',
    'IRLTLT01ZAM156N',
    'Long-Term Government Bond Yields: 10-year: Main (Including Benchmark) for South Africa',
    'Percent,Not Seasonally Adjusted',
    'NAEXKP01ZAQ657S',
    'Gross Domestic Product by Expenditure in Constant Prices: Total Gross Domestic Product for South Africa',
    'Growth Rate Previous Period,Seasonally Adjusted',
    'LQASRTZAM163N',
    'Liquid Assets to Total Assets (Liquid Asset Ratio) for South Africa',
    'Ratio,Not Seasonally Adjusted'
    )

fredSymbols <- SouthAfrica
for(iii in seq(1,length(fredSymbols),by = 3)){
  tmp0 <- 
      getSymbols(Symbols = fredSymbols[iii],src = 'FRED',auto.assign = F)
  obj0 <-
    na.omit(data.frame(Date=index(tmp0),tmp0,check.names = F,stringsAsFactors = F,row.names = NULL))
  colnames(obj0)[2] <- fredSymbols[iii+1]
  buf <- length(unique(day(obj0[,1])))
  if(3 < buf){
    dateFormat <- '%Y-%m-%d'
  }else{
    buf <- length(unique(month(obj0[,1])))
    if(buf == 1){dateFormat <- '%Y'}else{dateFormat <- '%Y-%m'}
  }
  fun_latestResult(obj = obj0,dateFormat = dateFormat)
  obj <- fun_fit(obj = obj0)[,c(1,2,3)]
  if(nrow(obj[0<=obj[,2],]) != nrow(obj)){type <- 'h'}else{type <- 'o'}
  par(mar = c(5,3,4,1),family = 'Meiryo',cex.main = 1,cex.axis = 1,font.main = 1)
  dateRange <- paste0(format(range(obj[,1]),dateFormat),collapse = '~')
  plot(x = obj[,1],y = obj[,2],type = type,pch = 20,cex = 0.5,
       xlab = '',ylab = '',
       main = paste0(colnames(obj)[2],'\n',fredSymbols[iii+2],'\n',dateRange),
       col = 'blue',
       panel.first = grid(nx = NULL,ny = NULL,lty = 2,equilogs = T))
  lines(x = obj[,1],y = obj[,3],type = 'l',lty = 2,col = 'red')
  latestResult <- gsub('(.+[0-9]):','\\1\n',latestResult)
  mtext(text = latestResult,side = 1,outer = F,line = 3)
  cat('\n\n<hr>\n\n')
}
```

### Economic Data From World Economic Outlook Databases(IMF)
- Source http://www.imf.org/external/ns/cs.aspx?id=28

```{r warning = F,error = F,message = F,echo = F,results = 'asis'}
aspxFile <-
  'https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/csv/WorldEconomicOutlook/201704/weoreptc.aspx'
tmp0 <-
  read.table(file = aspxFile,header = T,sep = '\t',stringsAsFactor = F,
             na.strings = c('','n/a'),
             check.names = F,fill = T,quote = "\"")
buf0 <- tmp0
objColumn0 <- 
  grep('^country$',colnames(buf0),ignore.case = T)
buf0[grep('stp',buf0$ISO,ignore.case = T),objColumn0] <- "São Tomé and Príncipe"
buf0[grep('civ',buf0$ISO,ignore.case = T),objColumn0] <- "Côte d'Ivoire"
objColumnYear <-
  grep('^[0-9]{4}$',colnames(buf0))
yearRange <-
  paste0(range(colnames(buf0)[objColumnYear]),collapse = '~')
buf0[,objColumnYear] <- 
  apply(buf0[,objColumnYear],2,function(x)as.numeric(gsub(',','',x)))
buf0 <- buf0[!is.na(buf0$ISO),]
WEO <- buf0
```

```{r warning = F,error = F,message = F,echo = F,results = 'hide'}
ISO <- unique(WEO$ISO)
WEO$`DesAndUnit` <- paste0(WEO$`Subject Descriptor`,'.Unit:',WEO$Units)
SubjectList <- unique(WEO$DesAndUnit)
isoN <- 184
forcastYear <- 2016
cex1 <- 1.1
cex2 <- 2.9
```

```{r warning = F,error = F,message = F,echo = F,results = 'asis'}
fun_extractWEO <- function(objCountry,Subject){
  buf0 <- WEO[WEO$ISO==objCountry,]
  buf1 <-
    subset(buf0,buf0$DesAndUnit==Subject)
  objColYear <-
    grep('^[0-9]{4}$',colnames(buf1))
  buf2 <- t(buf1[,objColYear])
  buf3 <-
    data.frame(Date=as.Date(paste0(row.names(buf2),'-1-1')),
               buf2[,1],stringsAsFactors = F,row.names = NULL)
  colnames(buf3)[2] <-
    buf1$`Subject Descriptor`
  buf3$cex <- ifelse(year(buf3$Date)<=forcastYear,cex1,cex2)
  buf3$col <- ifelse(year(buf3$Date)<=forcastYear,'blue','red')
  returnList <-
        list('tsUnit' = buf1$Units,
             'tsData' = na.omit(buf3),
             'tsNote' = buf1$`Subject Notes`,
             'tsScale' = buf1$Scale,
             'tsCountry' = buf1$Country)
  return(returnList)
}
fun_plot <- function(obj,Country,Unit,Scale=NA){
  par(mar=c(4,4,5,1),family='Meiryo',font.main=1,cex.main=1)
  dateRange <- paste0(format(range(obj[,1]),'%Y'),collapse = '~')
  plot(obj[,c(1,2)],xlab='',ylab='',
       main = paste0(Country,'\n',
                     colnames(obj)[2],'\n',
                     Unit,'\n',
                     if(!is.na(Scale)){paste0(Scale,'\n')},
                     dateRange),
       panel.first = grid(nx = NULL,ny = NULL,lty = 2,equilogs = T),
       type = 'o',pch = 20,col = obj$col,cex = obj$cex)
  abline(h = 0,lwd = 2)
}
```

```{r warning = F,error = F,message = F,echo = F,results = 'asis'}
subjectN <- c(1,3,4,8,9,17,22,24,25,27)
for(iii in seq(length(subjectN))){
  returnOBJ <- fun_extractWEO(objCountry = ISO[isoN],Subject = SubjectList[subjectN[iii]])
  if(nrow(returnOBJ$tsData)!=0){fun_plot(obj = returnOBJ$tsData,
                                         Country = returnOBJ$tsCountry,
                                         Unit = returnOBJ$tsUnit,
                                         Scale = returnOBJ$tsScale)}
  cat('\n\n<hr>\n\n')
}
```

### Economic Data From OECD
- Source https://stats.oecd.org/

```{r warning = F,error = F,message = F,echo = F,results = 'asis'}
userName <-
  Sys.info()['user']
pathToFile <-
  paste0('C:/Users/',userName,'/Desktop/pathToCSV/')
setwd(pathToFile)
fileName <-
  'defaultPath.csv'
buf <-
  read.csv(file = fileName,
           header = F,
           skip = 0,
           stringsAsFactor = F,
           check.names = F,
           fileEncoding = 'utf-8',quote = "\"")
pathOutputTOcsv <-
  paste0("C:/Users/",userName,buf[2,1],'csv/OECDFactbook/2015-2016/')
setwd(pathOutputTOcsv)
getwd()
csvFile <- dir()
tmp0 <-
  read.csv(file = csvFile,header = T,check.names = F,stringsAsFactors = F)
buf0 <- tmp0
colnames(buf0) <- iconv(colnames(buf0),from = 'utf8',to = 'utf8')
OECD <- buf0
```

```{r warning = F,error = F,message = F,echo = F,results = 'asis'}
ISO <- unique(OECD$LOCATION)
OECD$`DesAndUnit` <- paste0(OECD$Subject,'.Unit:',OECD$Unit)
SubjectList <- unique(OECD$DesAndUnit)
isoN <- 15
```

```{r warning = F,error = F,message = F,echo = F,results = 'asis'}
fun_extractOECD <- function(objCountry,Subject){
  buf0 <- OECD[OECD$LOCATION==objCountry,]
  buf1 <-
    buf0[buf0$DesAndUnit==Subject,]
  buf2 <-
    data.frame(Date=as.Date(paste0(buf1$Year,'-1-1')),buf1$Value,stringsAsFactors = F)
  colnames(buf2)[2] <- unique(buf1$Subject)
  buf2$col <- 'blue'
  buf2$cex <- 1.1
  returnList <-
        list('tsUnit' = unique(buf1$Unit),
             'tsData' = na.omit(buf2),
             'tsCountry' = unique(buf1$Country))
  return(returnList)
}
```

```{r warning = F,error = F,message = F,echo = F,results = 'asis'}
returnOBJ <- fun_extractOECD(objCountry = ISO[isoN],Subject = SubjectList[262])
fun_plot(obj = returnOBJ$tsData,Unit = returnOBJ$tsUnit,Country = returnOBJ$tsCountry)
```
