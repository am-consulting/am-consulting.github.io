---
knit: (function(inputFile, encoding) {username<-Sys.info()['user'];fileName<-'defaultPath.csv';pathToFile <-paste0('C:/Users/', username,'/Desktop/pathToCSV/');setwd(pathToFile);buf0<-read.csv(fileName,header = F,skip = 0,stringsAsFactor = F,check.names = F,fileEncoding = 'utf-8');timeStamp<-format(Sys.time(),'%Y%m%d%H%M%S');htmlName<-'GDPofJapan';rmarkdown::render(inputFile, encoding = encoding, output_file = paste0('C:/Users/',username,buf0[4,1],'am-consulting.co.jp-',htmlName,'.html')) })

title : '国内総生産 / Gross Domestic Product(GDP) of Japan'
author: 'アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp'
date: "`r format(Sys.time(), '%Y-%m-%d %H:%M:%S')`"
output: 
  html_document:
    fig_height: 5
    fig_width: 9  
    keep_md: no
    md_extensions: -ascii_identifiers 
    includes:
       in_header: insertHeader.html
    self_contained: false
---

```{r setup, include=FALSE}
tag <-
  read.csv(file = 'https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/components/insertHeader.csv',header = F,fileEncoding = 'UTF8')
tagTxt <- ''
for(rrr in 1:nrow(tag)){
  tagTxt <- paste0(tagTxt,tag[rrr,1],'\n')
}
insertFile <- file("insertHeader.html")
writeLines(text = tagTxt,con = insertFile)
close(insertFile)
```

- アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp
- SaECaNet http://saecanet.com/
- Olive http://olive.saecanet.com/
- twitter https://twitter.com/AMC2_Japan
- 本ページへのリンクを共有:<a href="https://twitter.com/share" class="twitter-share-button" data-via="AMC2_Japan" data-size="large">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<link rel="stylesheet" href="http://rawgit.com/am-consulting/am-consulting.github.io/master/components/jquery-responsive-tables/responsive-tables.css" type="text/css">

```{r set-options, echo=F, cache=F}
options(width = 900)
```

```{r,warning=F,error=F,message=F,echo=F}
library(RCurl)
library(mFilter)
# library(lubridate)
library(rAmCharts)
script <-
  getURL(
    "https://raw.githubusercontent.com/am-consulting/Rscript/master/importGDPofJapan.r",
    ssl.verifypeer = FALSE
  )
eval(parse(text = script))
```

```{r,warning=F,error=F,message=F,echo=F}
fileName <- 'functionList.csv'
functionList <-
  read.csv(
    file = paste0('https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/csv/',
                  fileName),
    header = F,
    as.is = T)
for(iii in 1:nrow(functionList)){
  script <- 
    getURL(paste0("https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/", functionList[iii,1]),
    ssl.verifypeer = F
  )
  eval(parse(text = script))
}
```

```{r,warning=F,error=F,message=F,results='hold',echo=F}
# 単位を10億円から兆円に変更
gdp1[,-1] <- apply(gdp1[,-1],2,function(x)x*10^-3)
gdp2[,-1] <- apply(gdp2[,-1],2,function(x)x*10^-3)
gdp6[,-1] <- apply(gdp6[,-1],2,function(x)x*10^-3)
gdp7[,-1] <- apply(gdp7[,-1],2,function(x)x*10^-3)
gdp8[,-1] <- apply(gdp8[,-1],2,function(x)x*10^-3)
gdp9[,-1] <- apply(gdp9[,-1],2,function(x)x*10^-3)
```

```{r,warning=F,error=F,message=F,results='hold',echo=F}
dateFormat <- '%Y年%m月期'
fun_latestResult(obj = gdp1,dateFormat = dateFormat)
dataTitle <- 
  paste0("日本の国内総生産(単位:兆円):名目GDP、実質GDP、年率換算、GDPデフレーター:",latestResult)
dataSource <- "内閣府"
windowsFonts(Meiryo = windowsFont("Meiryo"))
options(scipen = 999)
```

***

- `r paste0("タイトル : ", dataTitle)`
- `r paste0("データ出所 : ", dataSource)`
- http://www.esri.cao.go.jp/jp/sna/sokuhou/sokuhou_top.html
- 2016年12月8日以降、2009年に国連で合意された国際基準である「2008SNA」に基づいて推計が行われています。
- http://www.esri.cao.go.jp/jp/sna/data/data_list/kakuhou/files/h27/sankou/pdf/tyui27.pdf
- 実質季節調整系列(年率)
$$年率表示の成長率= \left (\left (\frac{当期の実質季節調整値実数}{前期の実質季節調整値実数}  \right ) ^{4}-1 \right )\times 100$$

- 名目原系列(寄与度)
$$寄与度＝\frac{\left(当期の実数-前年同期の実数\right)}{前年同期の国内総生産\left(支出側\right)\left(または国民総所得\right)}\times100$$

- 名目季節調整系列(寄与度)
$$寄与度＝\frac{\left(当期の実数-前期の実数\right)}{前期の国内総生産\left(支出側\right)\left(または国民総所得\right)}\times100$$

- 名目季節調整系列(年率)
$$年率表示の成長率= \left (\left (\frac{当期の名目季節調整値実数}{前期の名目季節調整値実数}  \right ) ^{4}-1 \right )\times 100$$

- 四半期デフレーター原系列
$$四半期デフレーター原系列=\left(\frac{名目原系列}{実質原系列}\right)\times100$$

- 四半期デフレーター季節調整系列
$$四半期デフレーター季節調整系列=\left(\frac{名目季節調整系列}{実質季節調整系列}\right)\times100$$

***

```{r,warning=F,error=F,message=F,echo=F}
gdp1Ratio0 <- data.frame(gdp1[, 1, drop = F],  round(gdp1[, -1] / gdp1[, 2] * 100, 2), check.names = F)
gdp2Ratio0 <- data.frame(gdp2[, 1, drop = F],  round(gdp2[, -1] / gdp2[, 2] * 100, 2), check.names = F)
gdp1Ratio <- gdp1Ratio0[,c(1,3,7,9)]
gdp1Ratio <-data.frame(gdp1Ratio,100-rowSums(gdp1Ratio[,-1]))
gdp2Ratio <- gdp2Ratio0[,c(1,3,7,9)]
gdp2Ratio <-data.frame(gdp2Ratio,100-rowSums(gdp2Ratio[,-1]))
colnames(gdp1Ratio)[5] <- colnames(gdp2Ratio)[5] <- 'その他'
```

```{r warning=F,error=F,message=F,echo=F}
mergeData <- merge(gdp1[,1:2],gdp2[,1:2],by = 'Date')
colnames(mergeData)[2] <- paste0(gsub('.x','',colnames(mergeData)[2]),'-名目季節調整値(兆円)')
colnames(mergeData)[3] <- paste0(gsub('.y','',colnames(mergeData)[3]),'-実質季節調整値(兆円)')
# fun_plotTimeSeries(obj = mergeData,
#                    chartType = 1,
#                    lwdL = 1,
#                    lwdR = 1,
#                    dataSource = dataSource,
#                    mar = c(3,5,4,2),
#                    dateFormat = dateFormat,
#                    needLefLab = 0)
# fun_addTxtToChart(obj = mergeData,cexTxt = 1,funType = 'min',col = 'black',objCol = 3)
```



```{r,warning=F,error=F,message=F,echo=F}
funFilter <- function() {
  tsData <- ts(tmp0[, 2] , frequency = 4 , start = c(year(tmp0[1, 1]), month(tmp0[1, 1])))
  tsDataHPfilter <- hpfilter(tsData)
  tsDataBKfilter <- bkfilter(tsData)
  tsDataCFfilter <- cffilter(tsData , root = T)
  HPTrend <- tsDataHPfilter$trend
  BKTrend <- tsDataBKfilter$trend
  CFTrend <- tsDataCFfilter$trend
  HPCycle <- tsDataHPfilter$cycle
  BKCycle <- tsDataBKfilter$cycle
  CFCycle <- tsDataCFfilter$cycle
  tmp0 <-
    data.frame(tmp0,
      HPTrend,
      BKTrend,
      CFTrend,
      HPCycle,
      BKCycle,
      CFCycle,
      check.names = F)
  colnames(tmp0)[3:8] <-
    c(
      'HP Filter Trend',
      'BK Filter Trend',
      'CF Filter Trend',
      'HP Filter Cycle',
      'BK Filter Cycle',
      'CF Filter Cycle'
    )
  dataSet0 <<- tmp0
}
```

```{r,warning=F,error=F,message=F,echo=F} 
funPlotTimeSeries01 <- function() {
  dataPeriod <-
    paste0(format(dataSet0[1, 1], dateFormat), '~', format(dataSet0[nrow(dataSet0), 1], dateFormat))
  mainTitle <-
    paste0(colnames(dataSet0)[obj01], '. ', dataPeriod)
  maxValue <- max(dataSet0[, obj01], dataSet0[, obj02])
  minValue <- min(dataSet0[, obj01], dataSet0[, obj02])
  par(mar = c(3, 5, 4, 5), family = 'Meiryo', font.main=1, cex.axis = 1, cex.lab = 1, cex.main = 1)
  plot(
    dataSet0[, 1],
    dataSet0[, obj01],
    type = 'l',
    xlab = '' ,
    ylab = '' ,
    xaxt = 'n',
    ylim = c(minValue, maxValue),
    main = paste(mainTitle, '\nSource:', dataSource),
    lwd = 1,
    col = lineColor[1]
  )
  panel.first = grid(nx = NULL,ny = NULL,lty = 2,equilogs = T)
  lines(dataSet0[, 1], dataSet0[, obj02], col = lineColor[2], lwd = 1)
  par(new = T)
  plot(
    dataSet0[, 1],
    dataSet0[, obj03],
    col = lineColor[3],
    type = 'h',
    xlab = '' ,
    ylab = '' ,
    xaxt = 'n',
    yaxt = 'n',
    lwd = 2
  )
  panel.first = grid(nx = NULL,ny = NULL,lty = 2,equilogs = T)
  axis(side = 4)
  mtext(colnames(dataSet0)[obj01], side = 2, line = 3.2, cex = 1)
  mtext(colnames(dataSet0)[obj03], side = 4, line = 3.2, cex = 1)
  graphics::legend(
    'bottomleft',
    col = lineColor,
    lty = 1,
    legend = c(colnames(dataSet0)[obj01], colnames(dataSet0)[obj02], colnames(dataSet0)[obj03]),
    cex = 1,
    bty = 'n'
  )
  axis.Date(side = 1, at = dataSet0[, 1], format = dateFormat, padj = 1)
}
```

```{r,warning=F,error=F,message=F,echo=F}
lineColor <- c('black', 'blue', 'red')
obj01 <- 2
obj02 <- 3
obj03 <- 6
tmp0 <- gdp1[, c(1, obj01)]
# funFilter()
# funPlotTimeSeries01()
```



```{r,warning=F,error=F,message=F,echo=F}
tmp0 <- gdp2[, c(1, obj01)]
# funFilter()
# funPlotTimeSeries01()
```



```{r,warning=F,error=F,message=F,echo=F,results='asis'}
# fun_dataTable(obj = gdp1,dateFormat = dateFormat,title = '(単位:兆円)')
```



```{r,warning=F,error=F,message=F,echo=F,results='asis'}
# fun_dataTable(obj = gdp2,dateFormat = dateFormat,title = '(単位:兆円)')
```



```{r,warning=F,error=F,message=F,echo=F}
tmp0 <- gdp1[, c(1, obj01)]
tmp0[, 2] <- log(tmp0[, 2])
colnames(tmp0)[2] <- paste0(colnames(tmp0)[2], '(自然対数)')
funFilter()
buf0 <- dataSet0
buf0[, -1] <- apply(buf0[, -1], 2, function(x) round(x, 4))
# funPlotTimeSeries01()
```


```{r,warning=F,error=F,message=F,echo=F}
tmp0 <- gdp2[, c(1, obj01)]
tmp0[, 2] <- log(tmp0[, 2])
colnames(tmp0)[2] <- paste0(colnames(tmp0)[2], '(自然対数)')
funFilter()
buf1 <- dataSet0
buf1[, -1] <- apply(buf1[, -1], 2, function(x) round(x, 4))
# funPlotTimeSeries01()
```



```{r,warning=F,error=F,message=F,echo=F,results='asis'}
# fun_dataTable(obj = buf0,dateFormat = dateFormat)
```



```{r,warning=F,error=F,message=F,echo=F,results='asis'}
# fun_dataTable(obj = buf1,dateFormat = dateFormat)
```



```{r,warning=F,error=F,message=F,echo=F} 
funPlotTimeSeries02 <- function() {
  dataPeriod <-
    paste0(format(dataSet0[1, 1], dateFormat), '~', format(dataSet0[nrow(dataSet0), 1], dateFormat))
  mainTitle <-
    paste0(colnames(dataSet0)[obj01], '. ', dataPeriod)
  par(mar = c(3, 3, 4, 2), family = 'Meiryo', font.main =1)
  plot(
    dataSet0[, 1],
    dataSet0[, obj01],
    type = lineType,
    xlab = colnames(dataSet0)[obj01] ,
    ylab = '' ,
    panel.first = grid(
      nx = NULL,
      ny = NULL,
      lty = 2,
      equilogs = T
    ) ,
    xaxt = 'n',
    main = paste(mainTitle, '\nSource:', dataSource),
    cex.axis = 1,
    cex.lab = 1,
    cex.main = 1.1,
    lwd = 2,
    col = dataSet0$col
  )
  axis.Date(side = 1, at = dataSet0[, 1], format = '%Y-%m', padj = 1, cex.axis = 1.0)
}
```

```{r,warning=F,error=F,message=F,echo=F}
obj01 <- 2
dataSet0 <- gdp3[, c(1, obj01)]
dataSet0$col <- ifelse(dataSet0[, 2] < 0, 'red', 'blue')
lineType <- 'h'
# funPlotTimeSeries02()
```



```{r,warning=F,error=F,message=F,echo=F}
dataSet0 <- gdp4[, c(1, obj01)]
dataSet0$col <- ifelse(dataSet0[, 2] < 0, 'red', 'blue')
lineType <- 'h'
# funPlotTimeSeries02()
```



```{r,warning=F,error=F,message=F,echo=F}
dataSet0 <- gdp5[, c(1, obj01)]
dataSet0$col <- ifelse(dataSet0[, 2] < 0, 'red', 'blue')
lineType <- 'l'
# funPlotTimeSeries02()
```



```{r,warning=F,error=F,message=F,echo=F,results='asis'}
# fun_dataTable(obj = gdp3,title = '(単位:%)',dateFormat = dateFormat)
```



```{r,warning=F,error=F,message=F,echo=F,results='asis'}
# fun_dataTable(obj = gdp4,title = '(単位:%)',dateFormat = dateFormat)
```



```{r,warning=F,error=F,message=F,echo=F,results='asis'}
# fun_dataTable(obj = gdp5,title = '(単位:%)',dateFormat = dateFormat)
```



```{r,warning=F,error=F,message=F,echo=F}
funamBarplot <- function(obj, mainTitle = '') {
  amBarplot(
    x = colnames(obj)[1] ,
    y = colnames(obj)[2:ncol(obj)],
    data = obj,
    horiz = T,
    stack_type = '100',
    legend = T,
    labelRotation = 0,
    main = mainTitle,
    mainColor = "#68838B",
    mainSize = 15,
    creditsPosition = "top-right",
    legendPosition = "bottom"
  )
}
```

```{r,warning=F,error=F,message=F,echo=F,results='asis'}
cat(paste0('\n\n#### 名目値構成比(%)\n\n'))
obj <- gdp1Ratio
obj[, 1] <- format(obj[, 1], dateFormat)
obj <- tail(obj, 10)
mainTitle <- ''
funamBarplot(obj, mainTitle)
```

***

```{r,warning=F,error=F,message=F,echo=F,results='asis'}
cat(paste0('\n\n#### 実質値構成比(%)\n\n'))
obj <- gdp2Ratio
obj[, 1] <- format(obj[, 1], dateFormat)
obj <- tail(obj, 10)
mainTitle <- ''
funamBarplot(obj, mainTitle)
```

***
#### 直近3期の推移
- 単位:兆円、パーセント

```{r,warning=F,error=F,message=F,echo=F,results='asis'}
for(iii in 1:15){
  GDPdata <- get(paste0('gdp',iii))
  tmp <- fun_transposeDataFrame(obj = GDPdata,dateFormat = dateFormat,tailN = 3)
  cat(paste0('\n\n##### ',gsub('([^:]+):.+','\\1',tmp[1,1]),'\n\n'))
  cat(fun.html.table(obj = tmp))
  cat('\n\n<hr>\n\n')
}
```

```{r warning=F,error=F,message=F,echo=F,results='hide',fig.height=5}
username <- Sys.info()['user']
pathToFile <- paste0('C:/Users/', username,'/Desktop/pathToCSV/')
setwd(pathToFile)
fileName <- 'defaultPath.csv'
buf <-
  read.csv(file = fileName,header = F,skip = 0,stringsAsFactor = F,check.names = F,
           fileEncoding = 'utf-8',quote = "\"")
pathOutputTOchart <- paste0("C:/Users/", username, buf[4,1])
setwd(pathOutputTOchart)
#---------------------------------------------------
pngFile <-
  paste0(htmlName, "1.png")
png(file = pngFile, width = 1000, height = 600)
##################
obj <- gdp5[,c(1,2,3)]
fun_plotTimeSeries(obj = obj,chartType = 1,typeL = 'o',typeR = 'o',
                   dateFormat = dateFormat,dataSource = dataSource,needLefLab = 0,
                   fitLcolor = 0,fitRcolor = 0,mar = c(4,4,5,1))
fun_addTxtToChart(obj = obj,funType = 'min',cexTxt = 1,col = 'black')
dev.off()
```

```{r warning=F,error=F,message=F,echo=F,results='hide'}
fun_outputMD(tags = '国内総生産',
             objDF = fun_transposeDataFrame(obj = obj,dateFormat = dateFormat,tailN = 5),
             htmlName = htmlName,
             image1 = 1,
             title = dataTitle,
             tableTitle = '直近5期',
             tableName = '国内総生産年率',
             buf.row = 4)
fun_updateURLcsv()
fun_updateURLcsv.olive()
```


<script src="http://rawgit.com/am-consulting/am-consulting.github.io/master/components/jquery-responsive-tables/jquery.responsive-tables.js"></script>
<script src="http://rawgit.com/am-consulting/am-consulting.github.io/master/components/jquery-responsive-tables/app.js"></script>

<script>MakeNegative();</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-3077339-5', 'auto');
  ga('send', 'pageview');

</script>
