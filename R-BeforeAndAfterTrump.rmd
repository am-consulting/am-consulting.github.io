```{r warning=F,error=F,message=F,echo=F,results='hide'}
baseURL <- 
  'https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/'
script <- 
  RCurl::getURL(paste0(baseURL,'R-writeCSVtoFolder.r'),ssl.verifypeer = F)
eval(parse(text = script))
```

```{r warning=F,error=F,message=F,echo=F,results='hide'}
baseURL01 <- 
  'https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/'
baseURL02 <- 
  'https://raw.githubusercontent.com/am-consulting/Rscript/master/'
```

```{r}
indicators <- c(
'Consumer Price Index for All Urban Consumers: All Items (CPIAUCNS)',
'Civilian Unemployment Rate (UNRATE)',
'All Employees: Total Nonfarm Payrolls (PAYEMS)',
'Real Gross Domestic Product (GDPC1)',
'Gross Domestic Product (GDP)',
'M2 Money Stock (M2SL)',
'10-Year Breakeven Inflation Rate (T10YIEM)',
'Commercial and Industrial Loans, All Commercial Banks (BUSLOANS)',
'S&P/Case-Shiller U.S. National Home Price Index (CSUSHPISA)',
'Personal Consumption Expenditures (PCE)',
'Civilian Labor Force Participation Rate (CIVPART)',
'Dow Jones Industrial Average (DJIA)',
'S&P 500 (SP500)',
'NASDAQ Composite Index (NASDAQCOM)',
'CBOE Volatility Index: VIX (VIXCLS)'
)
```

```{r}
library(XLConnect);library(Nippon);library(lubridate);library(quantmod);library(rvest)
cntList <- 0
dataDF <- list()
title <- vector()
unitDF <- data.frame()
for(iii in seq(length(indicators))){
  title[iii] <- gsub('(.+)\\((.+)\\)','\\1',indicators[iii])
  symbol <- gsub('(.+)\\((.+)\\)','\\2',indicators[iii])
  tmp0 <- 
    na.omit(getSymbols(Symbols = symbol,auto.assign = F,src = 'FRED'))
  tmp1 <-
    data.frame(Date = index(tmp0),tmp0,stringsAsFactors = F,row.names = NULL)
  colnames(tmp1)[2] <- title[iii]
  if(1<length(unique(day(tmp1[,1])))){
    tmp1$YM <- paste0(year(tmp1[,1]),'-',formatC(month(tmp1[,1]),width = 2,flag = '0'),'-01')
    buf <- aggregate(x = tmp1[,2],by=list(c(tmp1$YM)),FUN='mean')
    buf[,1] <- as.Date(buf[,1])
    buf[,2] <- round(buf[,2],4)
    colnames(buf) <- c('Date',paste0(title[iii],'*Average'))
    buf <- head(buf,-1)
    obj <- buf
  }else{
    obj <- tmp1
  }
  cntList <- cntList + 1
  dataDF[[cntList]] <- na.omit(obj)
  print(tail(dataDF[[cntList]]))
  # get unit
  htmlURL <- paste0('https://fred.stlouisfed.org/series/',symbol)
  htmlMarkup <- read_html(x = htmlURL,encoding = 'utf8')
  htmlUnit <- 
    htmlMarkup %>% html_nodes(xpath = "//span[@class = 'series-meta-value']")
  objUnit <- htmlUnit[[grep('units',htmlUnit,ignore.case = T)[1]]] %>% html_text()
  objUnit <- gsub('\\s+$','',objUnit)
  unitDF[iii,1] <- title[iii]
  unitDF[iii,2] <- objUnit
  # get unit
}
colnames(unitDF) <- c('Index','Unit')
```

```{r}
diffObj <- c('rate')
csvData <- data.frame()
rrr <- 0
for(iii in seq(length(dataDF))){
  obj <- dataDF[[iii]]
  b.a <- obj[obj[,1]==as.Date('2016-10-1'),]
  a.a <- tail(obj,1)
  csvData[iii,1] <- iii
  csvData[iii,2] <- colnames(obj)[2]
  csvData[iii,3] <- b.a[,2]
  csvData[iii,4] <- a.a[,2]
  csvData[iii,5] <- format(a.a[,1],'%Y-%m')
}
csvData[,2] <- sapply(csvData[,2],zen2han)
csvData[,c(3,4)] <- apply(csvData[,c(3,4)],2,as.numeric)
csvData[,6] <- round((csvData[,4]/csvData[,3]-1)*100,1)
objRaw <- grep(paste0(diffObj,collapse = '|'),csvData[,2],ignore.case = T)
csvData[objRaw,6] <- round(csvData[objRaw,4]-csvData[objRaw,3],10)
csvData[,7] <- '%'
csvData[objRaw,7] <- '%point'
csvData[,8] <-
  ifelse(csvData[,6] < 0,
         '<img border="0" src="https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/components/favicon-arrow-down.ico" alt="Decreased">',
         ifelse(0 < csvData[,6],
                '<img border="0" src="https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/components/favicon-arrow-up.ico" alt="Increased">','-'))
csvData <- csvData[,c(2,3,4,6,8,7,5)]
colnames(csvData) <- 
  c('Index','Before<br>TRUMP','After<br>TRUMP','Change','','Unit','Latest')
csvData[,1] <- gsub('Consumer Price Index','CPI',csvData[,1])
csvData[,1] <- gsub('\\s$','',csvData[,1])
```

```{r}
fun_writeCSVtoFolder(objData = csvData,dataType = 2,csvFileName = 'beforeAndAfterTrump')
fun_writeCSVtoFolder(objData = unitDF,dataType = 2,csvFileName = 'beforeAndAfterTrumpUnitDF')
```
