```{r}
fileName <- 
  'functionList.csv'
baseURL <- 
  'https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/'
functionList <- 
  read.csv(
    file = paste0(baseURL,'csv/',fileName),
    header = F,
    as.is = T)
for(iii in 1:nrow(functionList)){
  script <- 
    RCurl::getURL(paste0(baseURL,functionList[iii,1]),ssl.verifypeer = F)
  eval(parse(text = script))
}
```

```{r warning=F,error=F,message=F,echo=F,results='hide'}
windowsFonts(Meiryo = windowsFont("Meiryo"))
options(scipen = 100)
pngWidth <- 1500
pngHeight <- 800
```

```{r warning=F,error=F,message=F,echo=F,results='hide'}
library(quantmod);library(PerformanceAnalytics);library(lubridate)
userName <- Sys.info()['user']
fileName <- 'defaultPath.csv'
pathToFile <-
  paste0('C:/Users/',userName,'/Desktop/pathToCSV/')
setwd(pathToFile)
buf0 <-
  read.csv(fileName,header = F,skip = 0,stringsAsFactor = F,check.names = F,
           fileEncoding = 'UTF8')
pathOutputIndicator <- paste0('C:/Users/',userName,buf0[2,1],'charts/indicator/')
```

```{r}
sourceSite <- 2
```

```{r}
if(sourceSite==1){
periodN <- 30
fromFRED <- 
  c('Japan / U.S. Foreign Exchange Rate (DEXJPUS)',
    'U.S. / Euro Foreign Exchange Rate (DEXUSEU)',
    'Canada / U.S. Foreign Exchange Rate (DEXCAUS)',
    'U.S. / U.K. Foreign Exchange Rate (DEXUSUK)',
    'U.S. / Australia Foreign Exchange Rate (DEXUSAL)',
    'Switzerland / U.S. Foreign Exchange Rate (DEXSZUS)',
    'South Africa / U.S. Foreign Exchange Rate (DEXSFUS)',
    'U.S. / New Zealand Foreign Exchange Rate (DEXUSNZ)')
for(iii in seq(length(fromFRED))){
  buf <- fromFRED[iii]
  title <- gsub('(.+)\\((.+)\\)','\\1',buf)
  symbol <- gsub('(.+)\\((.+)\\)','\\2',buf)
  tmp0 <- getSymbols(Symbols = symbol,auto.assign = F,src = 'FRED')
  tmp1 <-
    data.frame(Date = index(tmp0),tmp0,stringsAsFactors = F,check.names = F,row.names = NULL)
  colnames(tmp1)[2] <- gsub('\\s$','',title)
  tmp1 <- na.omit(tmp1)
  if(iii==1){allFXdata0 <- tmp1}else{allFXdata0 <- merge(allFXdata0,tmp1,by='Date')}
  print(tail(tmp1))
}
allFXdata <- na.omit(allFXdata0)
colnames(allFXdata) <- 
  gsub('\\sforeign exchange rate','',colnames(allFXdata),ignore.case = T)
allFXdata$dateGroup <- as.Date(paste0(year(allFXdata$Date),'-',month(allFXdata$Date),'-1'))
}
```

```{r}
if(sourceSite!=1){
periodN <- 7
fromOANDA <- 
  c('USD/JPY','EUR/USD','GBP/USD','AUD/USD','NZD/USD',
    'EUR/GBP','EUR/AUD','GBP/AUD','EUR/CHF','GBP/CHF','USD/CHF')
for(iii in seq(length(fromOANDA))){
  tmp0 <- getSymbols(Symbols = fromOANDA[iii],auto.assign = F,src = 'oanda')
  tmp1 <-
    data.frame(Date = index(tmp0),tmp0,stringsAsFactors = F,check.names = F,row.names = NULL)
  colnames(tmp1) <- gsub('\\.','/',colnames(tmp1))
  tmp1 <- na.omit(tmp1)
  if(iii==1){allFXdata0 <- tmp1}else{allFXdata0 <- merge(allFXdata0,tmp1,by='Date')}
  print(tail(tmp1))
}
allFXdata <- na.omit(allFXdata0)
allFXdata$dateGroup <- ceiling(as.numeric(row.names(allFXdata))/periodN)
}
```

```{r}
fun_aggregateData <- function(fun = 'mean'){
  buf <- aggregate(x = allFXdata[,-1],by = list(allFXdata$dateGroup),FUN = fun)
  return(buf[,-grep('^dateGroup$',colnames(buf),ignore.case = T)])
}
fun_plotCorrelation <- function(fun = 'mean',output = 1){
  setwd(pathOutputIndicator)
  if(periodN==7){periodTxt <- paste0('By ',periodN,'days')}else{periodTxt <- 'By 1month'}
  obj <- fun_aggregateData(fun = fun)
  dateRange <- paste0(format(range(allFXdata$Date),'%Y-%m-%d'),collapse = '~')
  if(output!=0){
    png(file = paste0(fun,'-correlation-level.png'),width = pngWidth,height = pngHeight)
  }
  chart.Correlation(R = obj[,-1],
                    main = paste0(dateRange,'.Level.FUN=',fun,'.Period:',periodTxt),
                    cex.main = 2.2,cex.labels=2.5)
  if(output!=0){dev.off();}
  if(output!=0){
    png(file = paste0(fun,'-correlation-diff.png'),width = pngWidth,height = pngHeight)
  }
  chart.Correlation(R = fun_makeDiffTable(obj = obj,lag = 1)[,-1],
                    main = paste0(dateRange,'.1st Diff.FUN=',fun,'.Period:',periodTxt),
                    cex.main = 2.2,cex.labels=2.5)
  if(output!=0){dev.off();}
}
fun_plotCorrelation(fun = 'mean',output = 1)
fun_plotCorrelation(fun = 'var',output = 1)
```

```{r}
library(ggplot2);library(ggjoy)
fromOANDA <- 
  c('USD/JPY','EUR/JPY','GBP/JPY','AUD/JPY','NZD/JPY','CAD/JPY','CHF/JPY','TRY/JPY','ZAR/JPY',
    'EUR/USD','GBP/USD','AUD/USD','NZD/USD',
    'EUR/GBP','EUR/AUD','GBP/AUD','EUR/CHF','GBP/CHF','USD/CHF')
for(iii in seq(length(fromOANDA))){
  tmp0 <- getSymbols(Symbols = fromOANDA[iii],auto.assign = F,src = 'oanda')
  tmp1 <-
    data.frame(Date = index(tmp0),tmp0,stringsAsFactors = F,check.names = F,row.names = NULL)
  colnames(tmp1) <- gsub('\\.','/',colnames(tmp1))
  tmp1 <- na.omit(tmp1)
  if(iii==1){allFXdata0 <- tmp1}else{allFXdata0 <- merge(allFXdata0,tmp1,by='Date')}
  print(tail(tmp1))
}
allFXdata <- na.omit(allFXdata0)
allFXdataDoD <- fun_makeDiffRatioTable(obj = allFXdata,lag = 1,roundDigits = 5)
for(ccc in 2:ncol(allFXdataDoD)){
  buf0 <- data.frame(`In comparison with the day before(%)`=allFXdataDoD[,ccc],
                     Pair=colnames(allFXdataDoD)[ccc],
                     check.names = F,stringsAsFactors = F)
  if(ccc==2){reshapeData <- buf0}else{reshapeData <- rbind(reshapeData,buf0)}
}
reshapeData$Pair <-
  factor(x = reshapeData$Pair,levels = unique(reshapeData$Pair))
```

```{r}
g <- ggplot(data = reshapeData,aes(y = Pair,x = `In comparison with the day before(%)`))
g + geom_joy(scale=3,colour = 'white') + geom_vline(xintercept = 0, col = "#ffc1c1")
# 刈り込み追記
```
