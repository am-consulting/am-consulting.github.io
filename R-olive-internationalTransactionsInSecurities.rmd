---
knit: (function(inputFile, encoding) {username<-Sys.info()['user'];fileName<-'defaultPath.csv';pathToFile <-paste0('C:/Users/', username,'/Desktop/pathToCSV/');setwd(pathToFile);buf0<-read.csv(fileName,header = F,skip = 0,stringsAsFactor = F,check.names = F,fileEncoding = 'utf-8');timeStamp<-format(Sys.time(),'%Y%m%d%H%M%S');rmarkdown::render(inputFile, encoding = encoding, output_file = paste0('C:/Users/',username,buf0[2,1],'charts/','am-consulting.co.jp-internationalTransactionsInSecurities.html')) })
title : "International Transactions In Securities"
author: "アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp"
date: "`r format(Sys.time(), '%Y-%m-%d %H:%M:%S')`"
output: 
  html_document:
    fig_height: 8
    fig_width: 10
    keep_md: no
    md_extensions: -ascii_identifiers 
---
<link href="http://knowledgevault.saecanet.com/components/rmarkdown-html.css" rel="stylesheet">
<script src="http://knowledgevault.saecanet.com/components/JavascriptCode.js"></script>
<style>.main-container {max-width : 1000px;}</style>

- アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp
- SaECaNet http://saecanet.com/
- Olive http://olive.saecanet.com/
- twitter https://twitter.com/AMC2_Japan
- 本ページへのリンクを共有:<a href="https://twitter.com/share" class="twitter-share-button" data-via="AMC2_Japan" data-size="large">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

```{r warning = F, error = F, message = F, echo = F}
library(RCurl)
fileName <- 'functionList.csv'
functionList <-
  read.csv(
    file = paste0('https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/csv/',
                  fileName),
    header = F,
    as.is = T)
for(iii in 1:nrow(functionList)){
  script <- 
    getURL(paste0("https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/", 
                  functionList[iii,1]),
           ssl.verifypeer = F)
  eval(parse(text = script))
}
```

```{r set-options, echo=F, cache=F}
options(width = 1000)
```

```{r,warning=F,error=F,message=F,echo=F,results='hold'}
script <-
  getURL(
    "https://raw.githubusercontent.com/am-consulting/Rscript/master/internationalTransactionsInSecurities.r",
    ssl.verifypeer = FALSE
  )
eval(parse(text = script))
colnames(origData)[-1] <- namesJ
```

```{r,warning=F,error=F,message=F,results='hold',echo=F}
origData$year <- as.numeric(substring(origData[,2],1,4))
origData$month <- as.numeric(gsub('．','',(substring(origData[,2],6,7))))
origData$H <- ifelse(origData$month<=6,1,2)
origData$Q <- ifelse(origData$month<=3,1,ifelse(origData$month<=6,2,ifelse(origData$month<=9,3,4)))
origData[,2] <- gsub('．','.',origData[,2])
```

```{r,warning=F,error=F,message=F,results='hold',echo=F}
objColumn <- grep('持分-ネット',colnames(origData))
latestResult <- 
  paste0(tail(origData[,2],1),
         '(億円):',
         paste0(colnames(origData)[objColumn],':',tail(origData[,objColumn],1),collapse = ','))
dataTitle <- paste0(titleJ,':', latestResult)
dataSource <- '財務省'
windowsFonts(Meiryo = windowsFont("Meiryo"))
options(scipen = 999)
```

***

- `r paste0("タイトル : ", dataTitle)`
- `r paste0("データ出所 : ", dataSource)`
- Source : http://www.mof.go.jp/international_policy/reference/itn_transactions_in_securities/

***

1. 対外、対内ともプラス値は取得超を、マイナス値は処分超を意味します。
1. 対外証券投資
	1. 居住者による取得または処分
	1. 取得超は資産増加つまり資金流出、処分超は資産減少つまり資金流入を意味します。
1. 対内証券投資
	1. 非居住者による取得または処分
	1. 取得超は負債増加つまり資金流入、処分超は負債減少つまり資金流出を意味します。
1. 単位は全て億円。	

***

```{r warning=F,error=F,message=F,echo=F,results='asis'}
fun_dataTable(obj = tail(origData[,-grep('year|month|h|q',colnames(origData),ignore.case = T)],50),
              leftcolumns = 2,
              dateFormat = 0)
```

***
#### 対内証券投資の期間(年･半期･四半期)総計

```{r,warning=F,error=F,message=F,results='asis',echo=F}
tableStat <- data.frame()
cnt <- 1
objY <- unique(origData$year)
for(iii in objY){
  tmp <- subset(origData,origData$year==iii) 
  tableStat[cnt,1] <- iii  
  tableStat[cnt,2] <- sum(tmp$`対内-株式･投資ファンド持分-ネット`)
  tableStat[cnt,3] <- sum(tmp$`対内-中長期債-ネット`)
  cnt <- cnt+1
}

for(iii in objY){
  tmp <- subset(origData,origData$year==iii)
  for(sss in 1:2){
    tmp0 <- subset(tmp, tmp$H==sss)
    tableStat[cnt,1] <- paste0(iii,'-H',sss)
    tableStat[cnt,2] <- sum(tmp0$`対内-株式･投資ファンド持分-ネット`)
    tableStat[cnt,3] <- sum(tmp0$`対内-中長期債-ネット`)
    cnt <- cnt+1
  }
}  
  
for(iii in objY){
  tmp <- subset(origData,origData$year==iii)
  for(sss in 1:4){
    tmp0 <- subset(tmp,tmp$Q==sss)
    tableStat[cnt,1] <- paste0(iii,'-Q',sss)
    tableStat[cnt,2] <- sum(tmp0$`対内-株式･投資ファンド持分-ネット`)
    tableStat[cnt,3] <- sum(tmp0$`対内-中長期債-ネット`)
    cnt <- cnt+1
  }
}

tableStat <- data.frame(seq(1,nrow(tableStat)), tableStat, check.names = F, stringsAsFactors = F)
# tableStat[,3:4] <- format(tableStat[,3:4], big.mark=",", scientific=F)
colnames(tableStat) <- c('ID','年･半期･四半期','対内-株式･投資ファンド持分-ネット','対内-中長期債-ネット')

fun_dataTable(obj = tableStat,
              leftcolumns = 2,
              dateFormat = 0,
              title = paste0('対内証券投資(単位:億円) - ', 
                             head(origData[,2],1), ' ~ ', tail(origData[,2],1)))
```

```{r,warning=F,error=F,message=F,results='asis',echo=F,fig.height=5,fig.width=12}
# for(iii in seq(3, ncol(origData)-4, by=2)){
#   par(mfrow=c(1,2),mar = c(10, 5, 2, 2),oma=c(0,0,0,0),family='Meiryo')
#   for(ccc in seq(iii,min(iii+1,ncol(origData)))){
#     plotData <- origData[,c(1,2,ccc),drop=F]
#     plotData <- tail(plotData, 15)
#     plotData$color <- "blue"
#     plotData[plotData[, 3] < 0, ncol(plotData)] <- "red"
#     plotbuf <- 
#       barplot(
#         plotData[, 3],
#         names.arg = plotData[,2],
#         las = 3,
#         main = colnames(plotData)[3],
#         col = plotData$color,
#         density = 10,
#         ylab = "億円",
#         cex.main = 1,
#         cex.sub = 1,
#         cex.lab = 1,
#         cex.names = 1,
#         cex.axis = 1
#       )
#     text(
#       plotbuf,
#       y = plotData[, 3],
#       labels = plotData[, 3],
#       srt = 90,
#       cex = 1,
#       adj = c(-0.1, 0.5),
#       col = "black"
#     )
#   }
#   cat('<hr>')
# }
```

#### 株式･投資ファンド持分及び合計の基本統計量

```{r,warning=F,error=F,message=F,results='hold',echo=F}
statData <- origData[,c(1,2,5,8,13,16,19,24)]
cat(paste0(head(statData[,2],1),' - ',tail(statData[,2],1),'\n'))
apply(statData[,c(3,5,6,8)],2,summary)
```


#### 直近`r tailN <- 5;tailN`週分
##### 原数値(億円)

```{r,warning=F,error=F,message=F,results='asis',echo=F}
buf <- tail(origData, tailN)
buf <- buf[,-grep('year|month|h|q', colnames(buf), ignore.case = T)]
buf <- t(buf)
buf <- data.frame(rownames(buf), buf)
colnames(buf) <- unlist(buf[2, ])
buf <- buf[-(1:2), ]
colnames(buf)[1] <- '対象'
buf[,-1] <- apply(buf[,-1],2,as.numeric)
fun_markdownTable(obj = buf)
```

***
##### 前週差(億円)

```{r warning=F,error=F,message=F,echo=F,results='asis'}
WoW <- 
  data.frame(tail(origData[,2],-1),diff(as.matrix(origData[,-c(1:2)]),lag = 1),check.names = F,stringsAsFactors = F)
tDF <- t(tail(WoW[,1:23],tailN))
tDF <- data.frame(row.names(tDF),tDF,check.names = F,stringsAsFactors = F,row.names = NULL)
colnames(tDF) <- tDF[1,]
tDF <- tDF[-1,]
colnames(tDF)[1] <- '対象'
tDF[,-1] <- apply(tDF[,-1],2,as.numeric)
fun_markdownTable(tDF)
```

***
<script>MakeNegative()</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-3077339-5', 'auto');
  ga('send', 'pageview');

</script>
