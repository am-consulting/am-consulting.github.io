---
knit: (function(inputFile, encoding) {username<-Sys.info()['user'];fileName<-'defaultPath.csv';pathToFile <-paste0('C:/Users/', username,'/Desktop/pathToCSV/');setwd(pathToFile);buf0<-read.csv(fileName,header = F,skip = 0,stringsAsFactor = F,check.names = F,fileEncoding = 'utf-8');timeStamp<-format(Sys.time(),'%Y%m%d%H%M%S');rmarkdown::render(inputFile, encoding = encoding, output_file = paste0('C:/Users/',username,buf0[2,1],'charts/','am-consulting.co.jp-JapanesePhysique.html')) })
title : "Japanese Physique"
author: "アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp"
date: "`r format(Sys.time(), '%Y-%m-%d %H:%M:%S')`"
output: 
  html_document:
    fig_height: 5
    fig_width: 10
    keep_md: no
    md_extensions: -ascii_identifiers 
---
<link href="http://knowledgevault.saecanet.com/components/rmarkdown-html.css" rel="stylesheet">
<script src="http://knowledgevault.saecanet.com/components/JavascriptCode.js"></script>
<style>.main-container {max-width : 1000px;}</style>

 - アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp
 - SaECaNet http://saecanet.com/
 - Olive http://olive.saecanet.com/
 - twitter https://twitter.com/AMC2_Japan

本ページへのリンクを共有:<a href="https://twitter.com/share" class="twitter-share-button" data-via="AMC2_Japan" data-size="large">Tweet</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>


```{r set-options, echo=F, cache=F}
options(width = 1000)
```

```{r,warning=F,error=F,message=F,echo=F}
library(RCurl)
importAMCC <- 
  c('R-dygraphsFunction.r','R-dataTablesFunction.r','R-turningPoint.r','R-scatterPlot.r',
    'transposeDataFrame.r','R-fit.r','plotTimeSeries.r','R-turningPoint.r','timeSeriesDataFundamentalStatistics.r',
    'R-getLatestResult.r','R-markdownTable.r','R-makeDiffTable.r')
for(iii in 1:length(importAMCC)){
  script <- getURL(
    paste0("https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/", importAMCC[iii]),
    ssl.verifypeer = F
  )
  eval(parse(text = script))
}
```

```{r,warning=F,error=F,message=F,results='hold',echo=F}
dataTitle <- 
  '体力･運動能力調査 平成27年度 年齢別体格測定の結果 身長と体重'
dataSource <- 
  '文部科学省'
windowsFonts(Meiryo=windowsFont("Meiryo"))
options(scipen = 999)
```

***

- `r paste0("タイトル : ", dataTitle)`
- `r paste0("データ出所 : ", dataSource)`
- "標本にバイアスは無い"と想定しています。
- "標本のバイアス有無"は確認していません。

***

```{r,warning=F,error=F,message=F,results='hold',echo=F}
library(XLConnect);library(Nippon);library(lubridate)
username <- 
  Sys.info()['user']
pathOutput <- 
  paste0("C:/Users/", username, "/Desktop/R_Data_Write/")
setwd(pathOutput)
fileName <-
  'h27tai0002.xlsx'
download.file('http://www.e-stat.go.jp/SG1/estat/Xlsdl.do?sinfid=000031462537',
              fileName, mode = 'wb')
buf0 <-
  readWorksheetFromFile(paste0(pathOutput, fileName), sheet = 1, check.names = F, header = F)
tmp0 <- tmp1 <- NA
for(column in 1:ncol(buf0)){
  if(!is.na(buf0[3,column]) & length(grep('\\(',buf0[3,column])) != 1){
    tmp0 <- gsub('\\s','',buf0[3,column])
  }
  buf0[3,column] <- tmp0
  if(!is.na(buf0[4,column]) & length(grep('\\(',buf0[4,column])) != 1){
    tmp1 <- gsub('\\s','',buf0[4,column])
  }
  buf0[4,column] <- tmp1
}
colnames(buf0) <- 
  paste0(buf0[3,],':',buf0[4,],':',buf0[5,])
buf1 <- buf0[-c(1:5),]
buf1[,-1] <- apply(buf1[,-1],2,function(x)as.numeric(gsub(',','',x)))
colnames(buf1)[1] <- '年齢'
japanesePhysique <- buf1
```

```{r,warning=F,error=F,message=F,results='hold',echo=F}
funPlot01 <- 
  function(dataOBJ, mainTitle = '', objColumn) {
    plot(
    dataOBJ[, objColumn[1]],
    type = 'o',
    xaxt = 'n',
    xlab = colnames(dataOBJ)[1],
    ylab = '',
    col = 'blue',
    main = mainTitle,
    cex.axis = 1.2,
    cex.lab = 1.2,
    cex.main = 1.2,
    lwd = 1)
  panel.first = grid(nx = NULL, ny = NULL, lty = 2, equilogs = T)
  axis(side = 1, at = seq(1, nrow(dataOBJ)), labels = dataOBJ[, 1], las = 2, cex = 1.2)
  lines(dataOBJ[, objColumn[2]], type = 'o', col = 'red')
  graphics::legend('topleft', col = c('blue', 'red'), lty = 1, legend = colnames(dataOBJ)[objColumn], cex = 1.2, bty = 'n')
}
```

```{r,warning=F,error=F,message=F,results='hold',echo=F}
par(mfrow = c(1,3), mar = c(6,3,1,1), family = 'Meiryo', oma = c(0,0,3,0))
# 身長
objColumn <- c(3, 6)
funPlot01(dataOBJ = japanesePhysique, objColumn = objColumn)
# 体重
objColumn <- c(9, 12)
funPlot01(dataOBJ = japanesePhysique, objColumn = objColumn)
# BMI
bmiM <- 
  round(japanesePhysique[, 9]  / (japanesePhysique[, 3] / 100) ^ 2, 1)
bmiF <- 
  round(japanesePhysique[, 12] / (japanesePhysique[, 6] / 100) ^ 2, 1)
bmi <- 
  data.frame(japanesePhysique[, 1, drop = F], bmiM, bmiF)
colnames(bmi) <- 
  c('年齢', 'BMI:男子', 'BMI:女子')
objColumn <- c(2, 3)
funPlot01(dataOBJ = bmi, objColumn = objColumn, mainTitle = 'BMI = 体重(kg) ÷ 身長(m)^2')
mtext(paste(dataTitle, '\nSource:', dataSource), side = 3, outer = T)
```

```{r warning=F,error=F,message=F,results='hold',echo=F}
fun_populationMean <- 
  function(n, mean, sd, append) {
    sampleMean <- 
      japanesePhysique[, mean]
    sampleSD <- 
      japanesePhysique[, sd]
    sampleN <- 
      japanesePhysique[, n]
    t <- 
      qt(0.975, df = sampleN - 1, lower.tail = T)
    meanURange <- 
      round(sampleMean + t * sampleSD / sqrt(sampleN), 2)
    meanLRange <- 
      round(sampleMean - t * sampleSD / sqrt(sampleN), 2)
    pMean <- 
      data.frame(ID=seq(1, nrow(japanesePhysique)), 
                 japanesePhysique[, 1], 
                 meanLRange, 
                 meanURange, 
                 japanesePhysique[, mean], 
                 japanesePhysique[, sd], 
                 japanesePhysique[, n])
    colnames(pMean)[-1] <-
      paste0(c('年齢', 
               '推定母平均(CI95%,Lower)',
               '推定母平均(CI95%,Upper)', 
               colnames(japanesePhysique)[mean], 
               colnames(japanesePhysique)[sd],
               colnames(japanesePhysique)[n]),
             append)
    return(pMean)
}
```

<hr>
```{r,warning=F,error=F,message=F,results='asis',echo=F}
buf <- 
  data.frame(
    ID = seq(1,nrow(japanesePhysique)),
    japanesePhysique[,c(1,3,9),drop = F],
    bmi[,2,drop = F], 
    '身長(cm,+1σ)'=japanesePhysique[,3] + japanesePhysique[,4],
    '身長(cm,-1σ)'=japanesePhysique[,3] - japanesePhysique[,4],
    '身長(cm,+2σ)'=japanesePhysique[,3] + japanesePhysique[,4] * 2,
    '身長(cm,-2σ)'=japanesePhysique[,3] - japanesePhysique[,4] * 2,
    check.names = F)
fun_dataTable(obj = buf, dateFormat = 0, orderDirection = 'asc', leftcolumns = 2)
```
<hr>
```{r,warning=F,error=F,message=F,results='asis',echo=F}
buf <- 
  data.frame(
    ID = seq(1,nrow(japanesePhysique)), 
    japanesePhysique[,c(1,6,12),drop = F],
    bmi[,3,drop = F], 
    '身長(cm,+1σ)'=japanesePhysique[,6] + japanesePhysique[,7],
    '身長(cm,-1σ)'=japanesePhysique[,6] - japanesePhysique[,7],
    '身長(cm,+2σ)'=japanesePhysique[,6] + japanesePhysique[,7] * 2,
    '身長(cm,-2σ)'=japanesePhysique[,6] - japanesePhysique[,7] * 2,  
    check.names = F)
fun_dataTable(obj = buf, dateFormat = 0, orderDirection = 'asc', leftcolumns = 2)
```
<hr>
```{r,warning=F,error=F,message=F,results='asis',echo=F}
dataTable <- 
  fun_populationMean(n = 2,  mean = 3,  sd = 4,  append = '-男子')
fun_dataTable(obj = dataTable, dateFormat = 0, orderDirection = 'asc', leftcolumns = 2)
```
<hr>
```{r,warning=F,error=F,message=F,results='asis',echo=F}
dataTable <- 
  fun_populationMean(n = 5,  mean = 6,  sd = 7,  append = '-女子')
fun_dataTable(obj = dataTable, dateFormat = 0, orderDirection = 'asc', leftcolumns = 2)
```

***
#### 男女(20歳以上)の平均身長、平均体重

```{r,warning=F,error=F,message=F,results='hold',echo=F}
buf <-
  tail(japanesePhysique,-14)
obj <- c(2,3)
cat(paste0('男子平均身長(20歳以上,cm). Sum(',
           colnames(buf)[obj[1]],
           ' × ',
           colnames(buf)[obj[2]],
           ') / Sum(',
           colnames(buf)[obj[1]],
           ')\n'))
sum(buf[,obj[1]] * buf[,obj[2]]) / sum(buf[,obj[1]])
cat('\n\n')
obj <- c(8,9)
cat(paste0('男子平均体重(20歳以上,kg). Sum(',
           colnames(buf)[obj[1]],
           ' × ',
           colnames(buf)[obj[2]],
           ') / Sum(',
           colnames(buf)[obj[1]],
           ')\n'))
sum(buf[,obj[1]] * buf[,obj[2]]) / sum(buf[,obj[1]])
cat('\n\n')
obj <- c(5,6)
cat(paste0('女子平均身長(20歳以上,cm). Sum(',
           colnames(buf)[obj[1]],
           ' × ',
           colnames(buf)[obj[2]],
           ') / Sum(',
           colnames(buf)[obj[1]],
           ')\n'))
sum(buf[,obj[1]] * buf[,obj[2]]) / sum(buf[,obj[1]])
cat('\n\n')
obj <- c(11,12)
cat(paste0('女子平均体重(20歳以上,kg). Sum(',
           colnames(buf)[obj[1]],
           ' × ',
           colnames(buf)[obj[2]],
           ') / Sum(',
           colnames(buf)[obj[1]],
           ')\n'))
sum(buf[,obj[1]] * buf[,obj[2]]) / sum(buf[,obj[1]])
```

***

<script>MakeNegative();</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-3077339-5', 'auto');
  ga('send', 'pageview');

</script>
