---
knit: (function(inputFile, encoding) {username<-Sys.info()['user'];fileName<-'defaultPath.csv';pathToFile <-paste0('C:/Users/', username,'/Desktop/pathToCSV/');setwd(pathToFile);buf0<-read.csv(fileName,header = F,skip = 0,stringsAsFactor = F,check.names = F,fileEncoding = 'utf-8');timeStamp<-format(Sys.time(),'%Y%m%d%H%M%S');rmarkdown::render(inputFile, encoding = encoding, output_file = paste0('C:/Users/',username,buf0[2,1],'charts/','am-consulting.co.jp-',timeStamp,'.html')) })
title : "情報化"
author: "アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp"
output: 
  html_document:
    fig_height: 8
    fig_width: 12
    keep_md: no
    md_extensions: -ascii_identifiers 
---
<link href="http://knowledgevault.saecanet.com/components/rmarkdown-html.css" rel="stylesheet"> 
<style>
.main-container {
	max-width: 1200px;
	margin-left: auto;
	margin-right: auto;
}
</style>


```{r set-options, echo=F, cache=F}
options(width = 1000)
```

```{r warning=F, error=F, message=F, echo=F, results='hold'}
dataTitle <- '学校における教育の情報化の実態等に関する調査 平成27年度'
dataSource <- '文部科学省'
notes <- '複数のワードで検索する際は半角スペースで区切ってください'
notes0 <- "表中、-9999はNAを意味します"
Author <- "アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp"
htmlID <- timeStamp
cat(paste("Title :", dataTitle, "\n"))
cat(paste("Raw Data Source :", dataSource, "\n"))
cat(paste("Author :", Author, "\n"))
cat(paste("作成日 :", Sys.time(), "\n"))
cat(paste("特記 :", notes, "\n"))
cat(paste("特記 :", notes0, "\n"))
cat(paste("ID :", htmlID, "\n"))
windowsFonts(Meiryo=windowsFont("Meiryo"))
options(scipen = 999)
```

```{r warning=F, error=F, message=F, echo=F, results='hide'}
# http://www.stat.go.jp/data/guide/1.htm
# http://www.stat.go.jp/data/shihyou/index.htm
# http://www.stat.go.jp/data/shihyou/naiyou.htm
library(XLConnect)
library(car)
library(ggplot2)
library(gridExtra)
```

```{r warning=F, error=F, message=F, echo=F, results='hide'}
username <- Sys.info()['user']
pathOutput <- paste0("C:/Users/", username, "/Desktop/socialIndicatorsByPrefecture/")
setwd(pathOutput)
twoByte <- c("０","１","２","３","４","５","６","７","８","９")
oneByte <- c("0","1","2","3","4","5","6","7","8","9")
fileName <- paste0('0000313690', 50:61)
for(iii in 1:length(fileName)){
  fName <- fileName[iii]
  fNameXLS <- paste0(fName, '.xls')
  if(!file.exists(paste0(pathOutput, paste0(fName, '.xls')))) {
    download.file(paste0('http://www.e-stat.go.jp/SG1/estat/Xlsdl.do?sinfid=', fName), fNameXLS, mode = "wb")
  }
  buf0 <- readWorksheetFromFile(paste0(pathOutput, fNameXLS), sheet = 1, check.names = F, header = F)
  tmp <- ''
  for(ccc in 1:ncol(buf0)){
    if(!is.na(buf0[5,ccc])){tmp <- paste0(buf0[5,ccc], buf0[6,ccc])}
    buf0[5,ccc] <- paste0(tmp, buf0[11,ccc], '-', buf0[12,ccc])
  }
  buf1 <- buf0[,grep('\\(', buf0[5,]),drop=F]
  colnames(buf1) <- buf1[5,]
  for(sss in 1:length(twoByte)){
    colnames(buf1) <- gsub(pattern=twoByte[sss], replacement=oneByte[sss], x=colnames(buf1))
  }
  buf2 <- data.frame(buf0[,1:2], buf1, check.names = F, stringsAsFactors = F)
  buf2[,2] <- gsub(' ', '', buf2[,2]) 
  buf3 <- buf2[-(1:(which(buf2[,2]=="全国")-1)),,drop = F]
  buf3[,-(1:2)] <- apply(buf3[,-(1:2), drop = F], 2, function(x) as.numeric(gsub(',', '', x)))
  buf4 <- buf3[1:which(buf3[,1]==47),,drop=F]
  colnames(buf4)[1:2] <- c('ID', '都道府県')
  colnames(buf4) <- gsub('・', '･', gsub('］', ']', gsub('［', '[', gsub(' ', '', gsub('　', '', colnames(buf4))))))
  assign(paste0('JapanData', iii), buf4)
  if(iii==1){allData <- buf4}else{allData <- merge(allData, buf4, all = T, ID = ID)}
}
allData[,1] <- as.numeric(allData[,1])
colnames(allData)
title <- c(
'社会生活統計指標-都道府県の指標-2016-基礎データ-人口世帯_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-自然環境_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-経済基盤_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-行政基盤_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-教育_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-労働_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-文化・スポーツ_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-居住_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-健康・医療_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-福祉・社会保障_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-安全_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-家計_出所-総務省'
)
```

```{r warning=F, error=F, message=F, echo=F, results='hide'}
tmp <-
  read.table(
    'clipboard',
    header = T,
    sep = '\t',
    stringsAsFactor = F,
    na.strings = c('na', '', '-', 'NA'),
    check.names = F
  )
colnames(tmp) <- gsub('\n','',colnames(tmp))
tmp <- data.frame(ID = seq(1, nrow(tmp)), tmp, check.names = F, stringsAsFactors = F)
colnames(tmp) <- gsub('・', '･', 
                      gsub('］', ']', 
                           gsub('［', '[', 
                                gsub(' ', '', 
                                     gsub('　', '', 
                                          gsub('（', '(', 
                                               gsub('）', ')', 
                                                    gsub('％', '%', 
                                                         gsub('／', '/', colnames(tmp))))))))))
for(sss in 1:length(twoByte)){
  colnames(tmp) <- gsub(pattern=twoByte[sss], replacement=oneByte[sss], x=colnames(tmp))
}
twoByte <- c("Ａ","Ｂ","Ｃ","Ｄ","Ｅ","Ｆ","Ｇ","Ｈ","Ｉ","Ｊ","Ｋ","Ｌ",
             "Ｍ","Ｎ","Ｏ","Ｐ","Ｑ","Ｒ","Ｓ","Ｔ","Ｕ","Ｖ","Ｗ","Ｘ","Ｙ","Ｚ")
oneByte <- LETTERS
for(sss in 1:length(twoByte)){
  colnames(tmp) <- gsub(pattern=twoByte[sss], replacement=oneByte[sss], x=colnames(tmp))
}
colnames(tmp)
```

```{r warning=F, error=F, message=F, echo=F}
funGroup <- function(dS){
dS$Group <- 
  ifelse(as.numeric(dS$ID) <= 7, '北海道･東北地方',
  ifelse(as.numeric(dS$ID) <= 14,'関東地方',
  ifelse(as.numeric(dS$ID) <= 23,'中部地方',
  ifelse(as.numeric(dS$ID) <= 30,'関西地方',
  ifelse(as.numeric(dS$ID) <= 35,'中国地方',
  ifelse(as.numeric(dS$ID) <= 39,'四国地方','九州･沖縄地方'))))))
dS$Group <- as.factor(dS$Group)
colnames(dS)
return(dS)
}
```

```{r warning=F, error=F, message=F, echo=F}
fun_plot01 <- function(obj, objX, objY){
g1 <- ggplot(obj, aes(obj[,objX],obj[,objY]))
g1 <- g1 + geom_point(aes(colour = Group),size=4) 
g1 <- g1 + theme(legend.position = "top")
g1 <- g1 + theme(legend.title = element_blank())
g1 <- g1 + xlab(colnames(obj)[objX]) + ylab(colnames(obj)[objY])
g1 <- g1 + geom_smooth(method = "lm", se = T)
g2 <- ggplot(obj, aes(obj[,objX],obj[,objY]))
g2 <- g2 + geom_text(label=obj[,2])
g2 <- g2 + xlab(colnames(obj)[objX]) + ylab(colnames(obj)[objY])
g2 <- g2 + geom_smooth(method = "lm", se = T)
grid.arrange(g1, g2, ncol = 1)
}
```

```{r warning=F, error=F, message=F, echo=F}
funDataTable <- function(obj, width01, width02, order01) {
DT::datatable(
  obj,
  options = list(
    search.regex = F,
    paging = T,
    autoWidth = F,
    info = T,
    lengthChange = T,
    ordering = T,
    searching = T,
    scrollX = T,
    lengthMenu = list(c(10, -1, 1), c('10', 'All', '1')),
    orderClasses = T,
    order = list(list(0, order01)),
    columnDefs = list(list(width = width01, targets = 0), list(width = width02, targets = 1))
    ),
  rownames = F,
  caption = paste(dataTitle,'. Source:' ,dataSource),
  class = 'display compact',
  escape = F, # or escape = 'v1'(特定のcolumn) テーブル内でhtmlマークアップする場合に必須
  filter = 'bottom'
)
}
```

```{r warning=F, error=F, message=F, echo=F}
dataset <- funGroup(dS = tmp)
```

```{r warning=F, error=F, message=F, echo=F}
```
<hr>
```{r warning=F, error=F, message=F, echo=F}
funDataTable(obj = dataset[,-ncol(dataset)], width01 = '3%', width02 = '10%', order01 = 'asc')
```
<hr>
```{r warning=F, error=F, message=F, echo=F}
for(iii in 3:(ncol(dataset)-1)){
  print(summary(dataset[,iii,drop=F]))
  cat(paste0('Max / Min = ', round(max(dataset[,iii])/min(dataset[,iii]), 1)))  
  cat('\n\n')
}  
```
<hr>
####社会生活統計指標(出所:総務書)との相関

1. 擬似相関の検討は行っていません。
1. 因果関係の検討は行っていません。
1. 社会生活統計指標の掲載年度に注意して下さい。

```{r warning=F, error=F, message=F, echo=F, results='asis'}
a <- 68
b <- 3
objY <- seq(6,16)
compareData <- data.frame(allData[,1:2], allData[,a]/allData[,b], check.names = F, stringsAsFactors = F)
colnames(compareData)[3] <- paste0(colnames(allData)[a],"/",colnames(allData)[b])
```

```{r warning=F, error=F, message=F, echo=F, results='asis'}
dataSet <- merge(compareData, dataset, by = c('ID', '都道府県'))
objX <- 3
for(sss in objY){
  fun_plot01(obj = dataSet, objX = objX, objY = sss)
  cat('<hr>')
}
```