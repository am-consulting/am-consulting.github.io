---
knit: (function(inputFile, encoding) {username<-Sys.info()['user'];fileName<-'defaultPath.csv';pathToFile <-paste0('C:/Users/', username,'/Desktop/pathToCSV/');setwd(pathToFile);buf0<-read.csv(fileName,header = F,skip = 0,stringsAsFactor = F,check.names = F,fileEncoding = 'utf-8');timeStamp<-format(Sys.time(),'%Y%m%d%H%M%S');rmarkdown::render(inputFile, encoding = encoding, output_file = paste0('C:/Users/',username,buf0[2,1],'charts/','am-consulting.co.jp-socialIndicatorsByPrefecture.html')) })
title : "社会生活統計指標"
author: "アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp"
output: 
  html_document:
    fig_height: 7
    fig_width: 10
    keep_md: no
    md_extensions: -ascii_identifiers 
---
<link href="http://knowledgevault.saecanet.com/components/rmarkdown-html.css" rel="stylesheet"> 
<style>
.main-container {
	max-width: 1400px;
	margin-left: auto;
	margin-right: auto;
}

table{
 white-space: nowrap;
}
</style>


```{r set-options, echo=F, cache=F}
options(width = 1000)
```

```{r warning=F, error=F, message=F, echo=F, results='hold'}
dataTitle <- '社会生活統計指標-都道府県の指標-2016-基礎データ'
dataSource <- '総務省'
notes <- '複数のワードで検索する際は半角スペースで区切ってください'
notes0 <- "表中、-9999はNAを意味します"
Author <- "アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp"
cat(paste("Title       : ", dataTitle, "\n"))
cat(paste("Data Source : ", dataSource, "\n"))
cat(paste("Author      : ", Author, "\n"))
cat(paste("作 成 日    : ", Sys.time(), "\n"))
cat(paste("特    記    : ", notes, "\n"))
cat(paste("特    記    : ", notes0, "\n"))
windowsFonts(Meiryo = windowsFont("Meiryo"))
options(scipen = 999)
```

```{r warning=F, error=F, message=F, echo=F, results='hide'}
# http://www.stat.go.jp/data/guide/1.htm
# http://www.stat.go.jp/data/shihyou/index.htm
# http://www.stat.go.jp/data/shihyou/naiyou.htm
library(XLConnect)
library(car)
```

```{r warning=F, error=F, message=F, echo=F, results='hide'}
username <- Sys.info()['user']
pathOutput <- paste0("C:/Users/", username, "/Desktop/socialIndicatorsByPrefecture/")
setwd(pathOutput)
twoByte <- c("０","１","２","３","４","５","６","７","８","９")
oneByte <- c("0","1","2","3","4","5","6","7","8","9")
fileName <- paste0('0000313690', 50:61)
for(iii in 1:length(fileName)){
  fName <- fileName[iii]
  fNameXLS <- paste0(fName, '.xls')
  if(!file.exists(paste0(pathOutput, paste0(fName, '.xls')))) {
    download.file(paste0('http://www.e-stat.go.jp/SG1/estat/Xlsdl.do?sinfid=', fName), fNameXLS, mode = "wb")
  }
  buf0 <- readWorksheetFromFile(paste0(pathOutput, fNameXLS), sheet = 1, check.names = F, header = F)
  tmp <- ''
  for(ccc in 1:ncol(buf0)){
    if(!is.na(buf0[5,ccc])){tmp <- paste0(buf0[5,ccc], buf0[6,ccc])}
    buf0[5,ccc] <- paste0(tmp, buf0[11,ccc], '-', buf0[12,ccc])
  }
  buf1 <- buf0[,grep('\\(', buf0[5,]),drop=F]
  colnames(buf1) <- buf1[5,]
  for(sss in 1:length(twoByte)){
    colnames(buf1) <- gsub(pattern=twoByte[sss], replacement=oneByte[sss], x=colnames(buf1))
  }
  buf2 <- data.frame(buf0[,1:2], buf1, check.names = F, stringsAsFactors = F)
  buf2[,2] <- gsub(' ', '', buf2[,2]) 
  buf3 <- buf2[-(1:(which(buf2[,2]=="全国")-1)),,drop = F]
  buf3[,-(1:2)] <- apply(buf3[,-(1:2), drop = F], 2, function(x) as.numeric(gsub(',', '', x)))
  buf4 <- buf3[1:which(buf3[,1]==47),,drop=F]
  colnames(buf4)[1:2] <- c('ID', '都道府県')
  colnames(buf4) <- gsub('・', '･', gsub('］', ']', gsub('［', '[', gsub(' ', '', gsub('　', '', colnames(buf4))))))
  buf4[,1] <- as.numeric(buf4[,1])
  assign(paste0('JapanData', iii), buf4)
  if(iii==1){allData <- buf4}else{allData <- merge(allData, buf4, all = T, ID = ID)}
}
colnames(allData)
idName <- allData[,1:2]
title <- c(
'社会生活統計指標-都道府県の指標-2016-基礎データ-人口世帯_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-自然環境_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-経済基盤_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-行政基盤_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-教育_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-労働_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-文化・スポーツ_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-居住_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-健康・医療_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-福祉・社会保障_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-安全_出所-総務省',
'社会生活統計指標-都道府県の指標-2016-基礎データ-家計_出所-総務省'
)
```

```{r warning=F, error=F, message=F, echo=F}
funGroup <- function(dS){
dS$Group01 <- 
  ifelse(as.numeric(dS$ID) <= 7, '北海道･東北地方',
  ifelse(as.numeric(dS$ID) <= 14,'関東地方',
  ifelse(as.numeric(dS$ID) <= 23,'中部地方',
  ifelse(as.numeric(dS$ID) <= 30,'関西地方',
  ifelse(as.numeric(dS$ID) <= 35,'中国地方',
  ifelse(as.numeric(dS$ID) <= 39,'四国地方','九州･沖縄地方'))))))
dS$Group02 <- 
  ifelse(as.numeric(dS$ID) <= 14,'東日本','西日本')
dS$Group03 <- 
  ifelse(as.numeric(dS$ID) <= 14,'東日本',
  ifelse(as.numeric(dS$ID) <= 24,'中日本','西日本'))
dS$Group04 <- 
  ifelse(as.numeric(dS$ID) <= 1, '北海道',
  ifelse(as.numeric(dS$ID) <= 7, '東北地方',
  ifelse(16 <= as.numeric(dS$ID) & as.numeric(dS$ID) <= 18, '北陸地方',
  ifelse(8  <= as.numeric(dS$ID) & as.numeric(dS$ID) <= 15, '関東甲信越地方',
  ifelse(19 <= as.numeric(dS$ID) & as.numeric(dS$ID) <= 20, '関東甲信越地方',
  ifelse(21 <= as.numeric(dS$ID) & as.numeric(dS$ID) <= 24, '東海地方',
  ifelse(as.numeric(dS$ID) <= 30,'近畿地方',
  ifelse(as.numeric(dS$ID) <= 35,'中国地方',
  ifelse(as.numeric(dS$ID) <= 39,'四国地方','九州･沖縄地方')))))))))
colnames(dS)
return(dS)
}
```

```{r warning=F, error=F, message=F, echo=F}
funDataTable <- function(obj, orderColumn = 0, orderDirection = 'desc', width01 = '10%', width02 = '10%', caption = '') {
  DT::datatable(
    obj,
    extensions = c("Buttons", "ColReorder" , "FixedColumns", "FixedHeader"),
    options = list(paging = T, autoWidth = F, info = T, lengthChange = T, ordering = T,
      searching = T, scrollX = T, lengthMenu = list(c(15, -1, 1), c(15, 'All', 1)),
      orderClasses = T, order = list(list(orderColumn, orderDirection)), 
      search = list(regex = T, caseInsensitive = T), searchHighlight = T,
      columnDefs = list(list(width = width01, targets = 0), list(width = width02, targets = 1)),
      dom = 'BRlfrtip', buttons = I('colvis'), colReorder = T, fixedColumns = list(leftColumns = 1), fixedHeader = T),
    rownames = F, caption = caption, class = 'display compact', escape = F, filter = 'top'
  )  
}
```

```{r warning=F, error=F, message=F, echo=F, results='asis'}
dataset <- funGroup(dS = allData)
dataset0 <- dataset
dataset0[is.na(dataset0[,1]),1] <- 0
dataset0[is.na(dataset0)] <- -9999
dataset0[,2] <- paste0(formatC(dataset0[,1], width=2, flag="0"),dataset0[,2])
dataset0 <- dataset0[,-1]
```
<hr>
```{r warning=F, error=F, message=F, echo=F}
funDataTable(obj = dataset0, width01 = '3%', width02 = '10%', orderDirection = 'asc')
```
<hr>