---
knit: (function(inputFile, encoding) {username<-Sys.info()['user'];fileName<-'defaultPath.csv';pathToFile <-paste0('C:/Users/', username,'/Desktop/pathToCSV/');setwd(pathToFile);buf0<-read.csv(fileName,header = F,skip = 0,stringsAsFactor = F,check.names = F,fileEncoding = 'utf-8');rmarkdown::render(inputFile, encoding = encoding, output_file = paste0('C:/Users/',username,buf0[2,1],'charts/','am-consulting.co.jp-',format(Sys.time(),'%Y-%m-%d-%H-%M-%S'),'.html')) })
title : "政府債務"
author: "アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp"
output: 
  html_document:
    fig_height: 6
    fig_width: 12
    keep_md: no
    md_extensions: -ascii_identifiers 
---
<link href="http://knowledgevault.saecanet.com/components/rmarkdown-html.css" rel="stylesheet"> 
<style>
.main-container {
	max-width: 1200px;
	margin-left: auto;
	margin-right: auto;
}
</style>

```{r,warning=F,error=F,message=F,results='hold',echo=F}
dataTitle<-'政府債務のうち内国債の額(兆円)と内国債のうち日本銀行が保有する構成比 2016年6月分'
dataSource<-'日本銀行'
notes<-'複数のワードで検索する際は半角スペースで区切ってください'
notes0<-"表中、-9999はNAを意味します"
Author<-"アセット･マネジメント･コンサルティング株式会社 http://am-consulting.co.jp"
cat(paste("Title :",dataTitle,"\n"))
cat(paste("Raw Data Source :",dataSource,"\n"))
cat(paste("Author :",Author,"\n"))
cat(paste("作成日 :",Sys.time(),"\n"))
cat(paste("特記 :",notes,"\n"))
cat(paste("特記 :",notes0,"\n"))
windowsFonts(Meiryo=windowsFont("Meiryo"))
```

```{r,warning=F,error=F,message=F,echo=F}
loadTMP <- 1
```

```{r,warning=F,error=F,message=F,echo=F}
library(lubridate)
library(ggplot2)
library(scales)
library(reshape)
library(RCurl)
script <-
  getURL(
    'https://raw.githubusercontent.com/am-consulting/Rscript/master/Rscript_HighestAuthority.r',
    ssl.verifypeer = FALSE
  )
eval(parse(text = script))
highestAuthority()
```

```{r,warning=F,error=F,message=F,echo=F}
iii <- 1
highestData <- switch (iii,
                       get(titleAbb[1]),
                       get(titleAbb[2]),
                       get(titleAbb[3]),
                       get(titleAbb[4]))

FUN <- function(x) {
  highestData[which(highestData[1] <= x &
                      highestData[2] >= x, arr.ind = F), 3]
}
```

```{r,warning=F,error=F,message=F,echo=F}
if(loadTMP==1){
tmp <-
  read.table(
    'clipboard',
    header = T,
    sep = '\t',
    stringsAsFactor = F,
    na.strings = c('na', '', '-'),
    check.names = F
  )
}
```

```{r,warning=F,error=F,message=F,echo=F}
if(loadTMP==2){
library(RCurl)
script <-
  getURL(
    "https://raw.githubusercontent.com/am-consulting/Rscript/master/importPERPBR.r",
    ssl.verifypeer = FALSE
  )
eval(parse(text = script))
tmp <- PERPBR[,c(1,3,4)]
}
```

```{r,warning=F,error=F,message=F,echo=F}
dataSet <- na.omit(tmp)
#dataSet <- tail(dataSet,12*20)
dataSet[, 1] <- as.Date(dataSet[, 1])
dataSet <-
  data.frame(dataSet, apply(dataSet[1], 1, FUN), check.names = F)
colnames(dataSet)[ncol(dataSet)] <- indextitle[iii]
dateFormat = '%Y-%m-%d'
if (length(unique(day(dataSet[, 1]))) == 1) {
  dateFormat = '%Y-%m'
}
if (length(unique(month(dataSet[, 1]))) == 1) {
  dateFormat = '%Y'
}
borderdate <- max(highestData[1, 1], dataSet[1, 1])
```

```{r,warning=F,error=F,message=F,echo=F} 
funPlotTimeSeries <- function() {
mainTitle<-paste(colnames(dataSet)[obj01],'×',colnames(dataSet)[obj02])
maxValue<-max(dataSet[,obj01],dataSet[,obj02])
minValue<-min(dataSet[,obj01],dataSet[,obj02])
par(mar=c(3,5,3,5))
plot(
  dataSet[, 1],
  dataSet[, obj01],
  type = seriesType01,
  family = 'Meiryo',
  col = lineColor[1],
  xlab = '' ,
  ylab = '' ,
  panel.first = grid(
    nx = NULL,
    ny = NULL,
    lty = 2,
    equilogs = T
  ) ,
  xaxt = 'n',
  ylim = if(needYlim == 1){c(minValue, maxValue)},
  main = mainTitle,
  cex.axis = 1,
  cex.lab = 1,
  cex.main = 1,
  lwd = obj01lwd
  )
lo <- loess(dataSet[, obj01]~as.numeric(dataSet[, 1]))
lines(dataSet[, 1] , predict(lo) , col=lineColor[1], lwd=2,lty=2)




if(chartTtpe==1){
lines(
  dataSet[, 1],
  dataSet[, obj02],
  col = lineColor[2],
  lwd = obj02lwd
)
}else{  
par(new=T)
plot(
  dataSet[,1],
  dataSet[,obj02],
  col=lineColor[2],
  type=seriesType02,
  family='Meiryo' ,
  xlab='' ,
  ylab='' ,
  panel.first=grid(nx=NULL,ny=NULL,lty=2,equilogs=T) ,
  xaxt='n',
  yaxt='n',
  cex.axis=1,cex.lab=1,cex.main=1,
  lwd = obj02lwd
)    
axis(4,cex.axis=1,cex.lab=1)
mtext(colnames(dataSet)[obj01],side=2,line=3.2,cex=1)
mtext(colnames(dataSet)[obj02],side=4,line=3.2,cex=1)
}
lo <- loess(dataSet[, obj02]~as.numeric(dataSet[, 1]))
lines(dataSet[, 1] , predict(lo) , col=lineColor[2], lwd=2,lty=2)
legend('topleft',col=lineColor,lty=1,legend=c(colnames(dataSet)[obj01],colnames(dataSet)[obj02]),cex=1)
axis.Date(side=1,at=dataSet[,1],format=dateFormat,padj=1,cex.axis=1.0)  
}
```

```{r,warning=F,error=F,message=F,echo=F}
dataSet0<-dataSet
dataSet0[,1]<-format(dataSet0[,1],dateFormat)
funDataTable <- function() {
  DT::datatable(
    dataSet0,
    options = list(
      search.regex = T,
      paging = T,
      autoWidth = F,
      info = T,
      lengthChange = T,
      ordering = T,
      searching = T,
      scrollX = T,
      lengthMenu = list(c(10, -1, 1), c('10', 'All', '1')),
      orderClasses = T,
      order = list(list(0, 'desc')),
      columnDefs = list(
        list(width = '10%', targets = 0)#,
#        list(width = '25%', targets = 3)
        )
      ),
    rownames = F,
    caption = paste(dataTitle, dataSource),
    class = 'display compact'
  )
}
```

```{r,warning=F,error=F,message=F,results='asis',echo=F}
lineColor<-c('red','blue')
needYlim<-0
chartTtpe<-2
seriesType01<-'l'
seriesType02<-'l'
obj01<-2
obj02<-3
obj01lwd<-1
obj02lwd<-1
funPlotTimeSeries()
```
<hr>
```{r,warning=F,error=F,message=F,results='asis',echo=F}
funDataTable()
```