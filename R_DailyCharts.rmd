```{r}
library(quantmod);library(forecast);library(gridExtra);library(grid)
options(scipen = 999)
windowsFonts(Meiryo = windowsFont("Meiryo"))
username <- Sys.info()['user']
pathOutput <-
  paste("C:/Users/", username, "/Desktop/R_Data_Write/", sep = "")
setwd(pathOutput)
```

```{r,warning=F,error=F,message=F,echo=F}
library(RCurl)
fileName <- 'functionList.csv'
functionList <-
  read.csv(
    file = paste0('https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/csv/',
                  fileName),
    header = F,
    as.is = T)
for(iii in 1:nrow(functionList)){
  script <- 
    getURL(paste0("https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/", functionList[iii,1]),
    ssl.verifypeer = F
  )
  eval(parse(text = script))
}
```

```{r}
vii <-
  read.csv(file = 'https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/csv/VeryImportantIndexes.csv',
           header = F,
           quote = "\"",
           stringsAsFactors = F)
```

```{r}
amccTheme <- 
  gridExtra::ttheme_minimal(
    core = list(fg_params = list(hjust=1, cex = 2.0, x = 1, fontfamily = 'Meiryo')),
    colhead = list(fg_params = list(hjust=1, cex = 2.0, x = 1, fontfamily = 'Meiryo')),
    rowhead = list(fg_params = list(hjust=1, cex = 2.0, x = 1, fontfamily = 'Meiryo')))
```

```{r}
dateFormat <- '%Y-%m'
dataSource <- 'Federal Reserve Bank of St. Louis'
iii <- 2
tmp <-
  getSymbols(Symbols = vii[iii,1],auto.assign = F,src = 'FRED')
buf <-
  data.frame(Date = index(tmp),tmp,check.names = F,stringsAsFactors = F,row.names = NULL)
colnames(buf)[2] <- 
  paste0(vii[iii,2],':',vii[iii,3])
if(length(grep('^percent change',vii[iii,3],ignore.case = T))!=0){
  buf <-
    fun_makeDiffRatioTable(obj = buf,lag = 1)
}
obj <- tail(buf,3*12)
fun_plotTimeSeries(obj = obj,
                   typeL = 'h',
                   dateFormat = dateFormat,
                   lwdL = 2,
                   dataSource = dataSource,
                   needLefLab = 0,
                   chartType = 0,mar = c(4,3,5,3),fitLcolor = 2)
pushViewport(viewport(x = 0.2, y = 0.75))

tableDF <- tail(buf,3)
colnames(tableDF)[2] <- 'Value'
tableDF[,1] <- format(tableDF[,1],dateFormat)
grid.table(tableDF,row=NULL, theme = amccTheme)
```

```{r}
# #DOW , #NIKKEI , #FTSE , #10YrBond , #USDJPY , #VIX 
# 1300 * 900
rangeDays <- 60
symbolS <- c('^DJI','Dow Jones Industrial Average','DJI',
             '^N225','Nikkei 225','NIKKEI',
             '^FTSE','FTSE 100','FTSE',
             '^TNX','CBOE Interest Rate 10 Year T No','10Y T No',
             '^GDAXI','DAX','DAX',
             '^VIX','VOLATILITY S&P 500','VIX')
par(mfrow=c(3,2),oma=c(3,0,0,0))
maN <- 10
for(iii in seq(1,length(symbolS),by = 3)){
  price <-
    getSymbols(Symbols = symbolS[iii],auto.assign = F)
  pars <- chart_pars()
  pars$mar <- c(2,4,1,3)
  pars$cex <- 1
  dateRange <-
    paste0(range(tail(index(price),rangeDays)),collapse = '::')
  lastPrice <-
    round(as.vector(tail(price[,grep('close',colnames(price),ignore.case = T)],1)),2)
  print(chart_Series(x = price,
                     pars = pars,
                     subset = dateRange,
                     name = paste0(symbolS[iii+2],':',lastPrice),
                     TA = if(maN <= nrow(price)){print(add_SMA(n = maN))}))
}
mtext(text = paste0('Red Line:Moving Average(Over ',maN, ' days)'),side = 1,outer = T,col = 'red')
```

```{r}
# #SP500 , #NASDAQ , #RUSSELL2000 , #DAX , #KOSPI , #HANGSENG
rangeDays <- 60
symbolS <- c('^GSPC','S&P 500',
             '^IXIC','NASDAQ Composite',
             '^RUT','RUSSELL 2000 INDEX',
             '^GDAXI','DAX',
             '^KS11','KOSPI Composite Index',
             '^HSI','HANG SENG INDEX')
par(mfrow=c(3,2),oma=c(3,0,0,0))
maN <- 10
for(iii in seq(1,length(symbolS),by = 2)){
  price <-
    getSymbols(Symbols = symbolS[iii],auto.assign = F)
  pars <- chart_pars()
  pars$mar <- c(2,4,1,3)
  pars$cex <- 1
  dateRange <-
    paste0(range(tail(index(price),rangeDays)),collapse = '::')
  print(chart_Series(x = price,
                     pars = pars,
                     subset = dateRange,
                     name = symbolS[iii+1],
                     TA = if(maN <= nrow(price)){print(add_SMA(n = maN))}))
}
mtext(text = paste0('Red Line:Moving Average(Over ',maN, ' days)'),side = 1,outer = T,col = 'red')
```
