```{r}
library(quantmod);library(forecast);library(gridExtra);library(grid)
options(scipen = 999)
windowsFonts(Meiryo = windowsFont("Meiryo"))
```

```{r,warning=F,error=F,message=F,echo=F}
library(RCurl)
fileName <- 'functionList.csv'
functionList <-
  read.csv(
    file = paste0('https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/csv/',
                  fileName),
    header = F,
    as.is = T)
for(iii in 1:nrow(functionList)){
  script <- 
    getURL(paste0("https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/", functionList[iii,1]),
    ssl.verifypeer = F
  )
  eval(parse(text = script))
}
```

```{r}
fun_plot <- function(s = 1,e = 16,n = 10,tailN = 50,pngN = 1){
  pngFile <- paste0('AMCC-',pngN,".png")
  png(file = pngFile, width = 1400, height = 900)
  par(mfrow = c(4,4),oma = c(2,0,5,0),family = 'Meiryo',font.main = 2,mar = c(4,3,6,1),
      cex.main = 1.5,cex.axis = 1.4)
  for(iii in s:e){
    obj0 <- na.omit(dailyChart[[iii]])
    obj <- tail(fun_MovingAverage(obj = obj0,n= n,dateFormat = dateFormat),tailN)
    plot(obj[,1],obj[,2],type = 'o',xaxt = 'n',xlab = '',ylab = '',
         pch = 20,cex = 1.4,ylim = c(min(obj[,2:3]),max(obj[,2:3])),
         main = paste0(colnames(obj)[2],'\n',tail(obj,1)[,1],':',round(tail(obj,1)[,2],4),'\n',
                       paste0(range(obj[,1]),collapse = '~')))
    grid(nx = NULL, ny = NULL, col = "lightgray", lty = "dotted")
    axis.Date(side = 1,at = obj[,1],format = dateFormat)
    lines(obj[,1],obj[,3],type = 'l',col = 'red',lwd = 1.2)
  }
  mtext(text = paste0('Red Line:Moving Average(Over ',n,' days)'),
        side = 1,outer = T,col = 'red',cex = 1.5)
  mtext(text = paste0('Latest ',tailN,
                      ' days.Source:Oanda,FRED,MOF,CBOE,NIKKEI,IIMA,EIA,JSDA,S&P'),
        side = 3,outer = T,col = 'black',cex = 1.8,line = 1)
  dev.off()
}
```

```{r}
dailyChart <- list()
cnt <- 1
dateFormat <- '%Y%m%d'
fromOANDA <- c('USD/JPY','EUR/USD','BTC/USD','XAU/USD','XAU/XAG','XAU/XPT','BTC/XAU','ZAR/USD')
for(iii in seq(length(fromOANDA))){
  obj <- getSymbols(Symbols = fromOANDA[iii],auto.assign = F,src = 'oanda')
  colnames(obj) <- gsub('\\.','/',colnames(obj))
  dailyChart[[cnt]] <-
    data.frame(Date = index(obj),obj,stringsAsFactors = F,check.names = F,row.names = NULL)
  print(tail(dailyChart[[cnt]]))
  cnt <- cnt + 1
}
script <-
  RCurl::getURL(
    "https://raw.githubusercontent.com/am-consulting/Rscript/master/Rscript_JGBInterestRate.r",
    ssl.verifypeer = F)
eval(parse(text = script))
obj <-
  na.omit(jgbData[,c(1,grep('10y',colnames(jgbData),ignore.case = T))])
colnames(obj)[2] <- 
  paste0('JGB Interest Rate(%):',colnames(obj)[2])
dailyChart[[cnt]] <- obj
print(tail(dailyChart[[cnt]]))
cnt <- cnt + 1
obj <-
  na.omit(jgbData[,c(1,grep('30y',colnames(jgbData),ignore.case = T))])
colnames(obj)[2] <- 
  paste0('JGB Interest Rate(%):',colnames(obj)[2])
print(tail(obj))
dailyChart[[cnt]] <- obj
cnt <- cnt + 1
fromYahoo <- c('DGS10','10-Year Treasury Constant Maturity Rate',
               'T10Y2Y','10-Year Treasury Constant Maturity\n Minus 2-Year Treasury Constant Maturity')
for(iii in seq(1,length(fromYahoo),by = 2)){
  obj <- getSymbols(Symbols = fromYahoo[iii],auto.assign = F,src = 'FRED')
  obj <-
    data.frame(Date = index(obj),obj,
               stringsAsFactors = F,check.names = F,row.names = NULL)
  colnames(obj)[2] <- fromYahoo[iii+1]
  dailyChart[[cnt]] <- obj
  print(tail(dailyChart[[cnt]]))
  cnt <- cnt + 1
}
obj <-
  read.csv(
    file = 'http://www.cboe.com/publish/scheduledtask/mktdata/datahouse/vixcurrent.csv',
    header = T,
    as.is = T,
    check.names = F,
    stringsAsFactors = F,
    skip = 1)
obj[,1] <-
  as.Date(gsub('([0-9]+)/([0-9]+)/([0-9]+)','\\3-\\1-\\2',obj[,1]))
obj <-
  obj[,grep('date|close',colnames(obj),ignore.case = T)]
dailyChart[[cnt]] <- obj
print(tail(dailyChart[[cnt]]))
cnt <- cnt + 1
obj <-
  read.csv(
    file = 'http://indexes.nikkei.co.jp/nkave/historical/nikkei_stock_average_daily_en.csv',
    header = T,
    as.is = T,
    check.names = F,
    stringsAsFactors = F)
obj <- 
  na.omit(obj[,c(1,2)])
colnames(obj) <- 
  c('Date',paste0('NIKKEI225:',colnames(obj)[2]))
obj[,1] <- 
  as.Date(obj[,1])
print(tail(obj))
dailyChart[[cnt]] <- obj
buf_cnt <- cnt
importIndex <- 
  c('importPutCallRatios.r','importSkew.r','importTokyoRepoRate.r',
    'importHenryHubNaturalGasSpotPrice.r','importGMVI.r','importREIT.r',
    'importNaturalGasPrice.r','importNYMEXFuturesPrices.r','importLIBORandTED.r')
for(jjj in seq(length(importIndex))){
  script <- 
    RCurl::getURL(paste0("https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/", 
                         importIndex[jjj]),
                  ssl.verifypeer = F)
  eval(parse(text = script))
}
cnt <- buf_cnt
for(put in 1:5){
  cnt <- cnt + 1
  tmp <- putCallRatio[[put]]
  if(put!=5){
    obj <- na.omit(tmp[,c(1,ncol(tmp))])
  }else{
    obj <- na.omit(tmp[,c(1,2)])
  }
  obj[,1] <- 
    as.Date(obj[,1])
  dailyChart[[cnt]] <- obj
}
cnt <- cnt + 1
obj <- 
  na.omit(skewCBOE)
obj[,1] <- 
  as.Date(obj[,1])
dailyChart[[cnt]] <- obj
for(ccccc in 2:ncol(TokyoRepoRate)){
  cnt <- cnt + 1
  obj <- 
    na.omit(TokyoRepoRate[,c(1,ccccc)])
  obj[,1] <- 
    as.Date(obj[,1])
  colnames(obj)[2] <- paste0('Tokyo Repo Rate\n',colnames(obj)[2])
  dailyChart[[cnt]] <- obj
}
cnt <- cnt + 1
obj <- 
  na.omit(HenryHubNaturalGasSpotPrice[[1]])
obj[,1] <- 
  as.Date(obj[,1])
colnames(obj)[2] <- 
  gsub('price\\s','Price\n',colnames(obj)[2],ignore.case = T)
dailyChart[[cnt]] <- obj
tmp <- NaturalGasPrice[[2]]
tmp[,1] <- as.Date(tmp[,1])
for(cccc in 2:ncol(tmp)){
  cnt <- cnt + 1
  obj <- na.omit(tmp[,c(1,cccc)])
  colnames(obj)[2] <- 
    gsub('\\s\\(Dollars','\n(Dollars',colnames(obj)[2],ignore.case = T)
  dailyChart[[cnt]] <- obj
}
for(nnnn in c(1,3,4)){
  tmp <- NYMEXFuturesPrices[[nnnn]]
  tmp[,1] <- as.Date(tmp[,1])
  for(cccc in 2:ncol(tmp)){
    cnt <- cnt + 1
    obj <- na.omit(tmp[,c(1,cccc)])
    colnames(obj)[2] <- 
      gsub('\\s\\(Dollars','\n(Dollars',colnames(obj)[2],ignore.case = T)
    dailyChart[[cnt]] <- obj
  }
}
for(cccc in 2:ncol(LIBOR)){
  cnt <- cnt + 1
  obj <- na.omit(LIBOR[,c(1,cccc)])
  colnames(obj)[2] <- 
    gsub('\\s\\(LIBOR','\n(LIBOR',colnames(obj)[2],ignore.case = T)
  dailyChart[[cnt]] <- obj
}
for(gggg in c(2:5,7)){
  cnt <- cnt + 1
  obj <- 
    na.omit(GMVI1[,c(1,gggg)])
  obj[,1] <- 
    as.Date(obj[,1])
  dailyChart[[cnt]] <- obj
}
for(gggg in c(2:9)){
  cnt <- cnt + 1
  obj <- 
    na.omit(GMVI2[,c(1,gggg)])
  colnames(obj)[2] <- gsub(':','\n',colnames(obj)[2])
  obj[,1] <- 
    as.Date(obj[,1])
  dailyChart[[cnt]] <- obj
}
cnt <- cnt + 1
obj <- 
  na.omit(`sp-global-reit-us-dollar`[,c(1,3)])
obj[,1] <- 
  as.Date(obj[,1])
obj[,2] <- 
  as.numeric(obj[,2])
dailyChart[[cnt]] <- obj
cnt <- cnt + 1
obj <- 
  na.omit(`sp-united-states-reit-us-dollar`[,c(1,3)])
obj[,1] <- 
  as.Date(obj[,1])
obj[,2] <- 
  as.numeric(obj[,2])
dailyChart[[cnt]] <- obj
cnt <- cnt + 1
obj <- 
  na.omit(`sp-developed-reit-us-dollar`[,c(1,3)])
obj[,1] <- 
  as.Date(obj[,1])
obj[,2] <- 
  as.numeric(obj[,2])
dailyChart[[cnt]] <- obj
```

```{r}
userName <- Sys.info()['user']
fileName <- 'defaultPath.csv'
pathToFile <-
  paste0('C:/Users/',userName,'/Desktop/pathToCSV/')
setwd(pathToFile)
buf0 <-
  read.csv(fileName,header = F,skip = 0,stringsAsFactor = F,check.names = F,
           fileEncoding = 'UTF8')
pathOutput <- paste0('C:/Users/',userName,buf0[2,1],'charts/indicator/')
setwd(pathOutput)
fun_plot(pngN = 1)
fun_plot(s = 17,e = 32,pngN = 2)
fun_plot(s = 33,e = length(dailyChart),pngN = 3)
#NIKKEI , #10YrJGB , #10YrBond , #USDJPY , #VIX, #EURUSD, #Bitcoin, #Gold, #SKEW, #Put, #Call, #TokyoRepoRate, #Henryhub, #REIT
# 1400 * 900
```

```{r}
# #DOW , #NIKKEI , #FTSE , #10YrBond , #USDJPY , #VIX 
# 1300 * 900
rangeDays <- 60
symbolS <- c('^DJI','Dow Jones Industrial Average','DJI',
             '^N225','Nikkei 225','NIKKEI',
             '^FTSE','FTSE 100','FTSE',
             '^TNX','CBOE Interest Rate 10 Year T No','10Y T No',
             '^GDAXI','DAX','DAX',
             '^VIX','VOLATILITY S&P 500','VIX')
par(mfrow=c(3,2),oma=c(3,0,0,0))
maN <- 10
for(iii in seq(1,length(symbolS),by = 3)){
  price <-
    getSymbols(Symbols = symbolS[iii],auto.assign = F)
  pars <- chart_pars()
  pars$mar <- c(2,4,1,3)
  pars$cex <- 1
  dateRange <-
    paste0(range(tail(index(price),rangeDays)),collapse = '::')
  lastPrice <-
    round(as.vector(tail(price[,grep('close',colnames(price),ignore.case = T)],1)),2)
  print(chart_Series(x = price,
                     pars = pars,
                     subset = dateRange,
                     name = paste0(symbolS[iii+2],':',lastPrice),
                     TA = if(maN <= nrow(price)){print(add_SMA(n = maN))}))
}
mtext(text = paste0('Red Line:Moving Average(Over ',maN, ' days)'),side = 1,outer = T,col = 'red')
```

```{r}
# #SP500 , #NASDAQ , #RUSSELL2000 , #DAX , #KOSPI , #HANGSENG
rangeDays <- 60
symbolS <- c('^GSPC','S&P 500',
             '^IXIC','NASDAQ Composite',
             '^RUT','RUSSELL 2000 INDEX',
             '^GDAXI','DAX',
             '^KS11','KOSPI Composite Index',
             '^HSI','HANG SENG INDEX')
par(mfrow=c(3,2),oma=c(3,0,0,0))
maN <- 10
for(iii in seq(1,length(symbolS),by = 2)){
  price <-
    getSymbols(Symbols = symbolS[iii],auto.assign = F)
  pars <- chart_pars()
  pars$mar <- c(2,4,1,3)
  pars$cex <- 1
  dateRange <-
    paste0(range(tail(index(price),rangeDays)),collapse = '::')
  print(chart_Series(x = price,
                     pars = pars,
                     subset = dateRange,
                     name = symbolS[iii+1],
                     TA = if(maN <= nrow(price)){print(add_SMA(n = maN))}))
}
mtext(text = paste0('Red Line:Moving Average(Over ',maN, ' days)'),side = 1,outer = T,col = 'red')
```

```{r}
vii <-
  read.csv(file = 'https://raw.githubusercontent.com/am-consulting/am-consulting.github.io/master/csv/VeryImportantIndexes.csv',
           header = F,
           quote = "\"",
           stringsAsFactors = F)
```

```{r}
amccTheme <- 
  gridExtra::ttheme_minimal(
    core = list(fg_params = list(hjust=1, cex = 2.0, x = 1, fontfamily = 'Meiryo')),
    colhead = list(fg_params = list(hjust=1, cex = 2.0, x = 1, fontfamily = 'Meiryo')),
    rowhead = list(fg_params = list(hjust=1, cex = 2.0, x = 1, fontfamily = 'Meiryo')))
```

```{r}
dateFormat <- '%Y-%m'
dataSource <- 'Federal Reserve Bank of St. Louis'
iii <- 2
tmp <-
  getSymbols(Symbols = vii[iii,1],auto.assign = F,src = 'FRED')
buf <-
  data.frame(Date = index(tmp),tmp,check.names = F,stringsAsFactors = F,row.names = NULL)
colnames(buf)[2] <- 
  paste0(vii[iii,2],':',vii[iii,3])
if(length(grep('^percent change',vii[iii,3],ignore.case = T))!=0){
  buf <-
    fun_makeDiffRatioTable(obj = buf,lag = 1)
}
obj <- tail(buf,3*12)
fun_plotTimeSeries(obj = obj,
                   typeL = 'h',
                   dateFormat = dateFormat,
                   lwdL = 2,
                   dataSource = dataSource,
                   needLefLab = 0,
                   chartType = 0,mar = c(4,3,5,3),fitLcolor = 2)
pushViewport(viewport(x = 0.2, y = 0.75))

tableDF <- tail(buf,3)
colnames(tableDF)[2] <- 'Value'
tableDF[,1] <- format(tableDF[,1],dateFormat)
grid.table(tableDF,row=NULL, theme = amccTheme)
```
